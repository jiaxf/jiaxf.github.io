<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>飞天雪的技术博客</title>
  <icon>https://www.gravatar.com/avatar/221bd4f690152d292d31dbe2f498412f</icon>
  <subtitle>技术无止境</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://jiaxf.github.io/"/>
  <updated>2019-10-12T02:52:31.000Z</updated>
  <id>http://jiaxf.github.io/</id>
  
  <author>
    <name>Jiaxf</name>
    <email>jiaxuefeng0@gmail.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>https请求过程</title>
    <link href="http://jiaxf.github.io/2019/10/11/https%E8%AF%B7%E6%B1%82%E8%BF%87%E7%A8%8B/"/>
    <id>http://jiaxf.github.io/2019/10/11/https请求过程/</id>
    <published>2019-10-11T01:39:18.000Z</published>
    <updated>2019-10-12T02:52:31.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="HTTP与HTTPS的不同点："><a href="#HTTP与HTTPS的不同点：" class="headerlink" title="HTTP与HTTPS的不同点："></a>HTTP与HTTPS的不同点：</h1><ul><li>1、HTTPS需要用到CA申请证书。</li><li>2、HTTP是超文本传输协议，信息是明文的；HTTPS则是具有安全性的SSL加密传输协议。</li><li>3、HTTPS和HTTP使用的是完全不同的连接方式，用的端口也不一样，HTTP是80,HTTPS是443。</li><li>4、HTTP的连接很简单，是无状态的，HTTPS是HTTP+SSL协议构建的，可进行加密传输、身份认证的网络协议，比HTTP协议安全。</li></ul><h1 id="HTTPS的优势"><a href="#HTTPS的优势" class="headerlink" title="HTTPS的优势"></a>HTTPS的优势</h1><ul><li>1、内容加密，建立一个信息的安全通道，来保证数据传输过程的安全性。</li><li>2、身份认证，确认网站的真是性。</li><li>3、数据完整性，防止内容被第三方冒充或者篡改。</li></ul><h1 id="HTTPS请求过程"><a href="#HTTPS请求过程" class="headerlink" title="HTTPS请求过程"></a>HTTPS请求过程</h1><p>HTTPS协议的本质就是HTTP + SSL(or TLS)。在HTTP报文进入TCP报文之前，先使用SSL对HTTP报文进行加密。从网络的层级结构看它位于HTTP协议与TCP协议之间。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">SSL</span><span class="params">(Secure Sokcet Layer，安全套接字层)</span></span></span><br><span class="line"><span class="function"><span class="title">TLS</span><span class="params">(Transport Layer Security,传输层安全协议)</span></span></span><br></pre></td></tr></table></figure><p><img src="/img/http&amp;https.png" alt=""></p><p>HTTPS在传输数据之前需要客户端与服务器进行一个握手(TLS/SSL握手)，在握手过程中将确立双方加密传输数据的密码信息。</p><p><img src="/img/https过程.png" alt=""></p><pre><code>1、浏览器发起往服务器的 443 端口发起请求，请求携带了浏览器支持的加密算法和哈希算法。2、服务器收到请求，选择浏览器支持的加密算法和哈希算法。3、服务器下将数字证书返回给浏览器，这里的数字证书可以是向某个可靠机构申请的，也可以是自制的。    （注释：证书包括以下这些内容：1. 证书序列号。2. 证书过期时间。3. 站点组织名。4. 站点DNS主机名。5. 站点公钥。6. 证书颁发者名。7. 证书签名。因为证书是要给大家用的，所以不需要加密传输）4、浏览器进入数字证书认证环节，这一部分是浏览器内置的 TSL 完成的：    4.1 首先浏览器会从内置的证书列表中索引，找到服务器下发证书对应的机构，如果没有找到，此时就会提示用户该证书是不是由权威机构颁发，是不可信任的。如果查到了对应的机构，则取出该机构颁发的公钥。    4.2 用机构的证书公钥解密得到证书的内容和证书签名，内容包括网站的网址、网站的公钥、证书的有效期等。浏览器会先验证证书签名的合法性（验证过程类似上面 Bob 和 Susan 的通信）。    签名通过后，浏览器验证证书记录的网址是否和当前网址是一致的，不一致会提示用户。如果网址一致会检查证书有效期，证书过期了也会提示用户。这些都通过认证时，浏览器就可以安全使用证书中的网站公钥了。    4.3 浏览器生成一个随机数 R，并使用网站公钥对 R 进行加密。5、浏览器将加密的 R 传送给服务器。6、服务器用自己的私钥解密得到 R。7、服务器以 R 为密钥使用了对称加密算法加密网页内容并传输给浏览器。8、浏览器以 R 为密钥使用之前约定好的解密算法获取网页内容。</code></pre><blockquote><p>数字证书如何认证？<br>首先你的证书会在https握手过程中被传递到浏览器，浏览器从你的证书中找到了颁发者，从颁发者的证书（如果你电脑上有的话）又找到了CA的证书<br>（CA证书会在操作系统安装时就安装好，所以每个人电脑上都有根证书），使用CA证书中带的公钥来对颁发者证书做验签，一旦匹配，说明你电脑上的颁发者证书不是伪造的，<br>同理，再用颁发者证书中的公钥去验证你的证书，&gt; 以此证明你的证书不是伪造的。这样整个链状的验证，从而确保你的证书一定是直接或间接从CA签发的，<br>这样浏览器地址栏会显示一个绿色的盾牌，表示你的网站能通过证书验证<br>如果你的电脑上没有颁发者证书（断链）或者你自己本身就是自签名证书（自己做CA，但是要记得，人家电脑上并没有装你的自签名根证书），<br>那么浏览器会报警提示不能验证证书，问你是否还需要继续。</p></blockquote><h1 id="对比HTTP和HTTPS的传输"><a href="#对比HTTP和HTTPS的传输" class="headerlink" title="对比HTTP和HTTPS的传输"></a>对比HTTP和HTTPS的传输</h1><p><img src="/img/https传输.png" alt=""></p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.jianshu.com/p/116ebf3034d9" target="_blank" rel="noopener">简书 OKHttp源码解析(二)：”前戏”——HTTP的那些事</a></li><li><a href="https://blog.csdn.net/jlin991/article/details/59110060" target="_blank" rel="noopener">CSDN博客 HTTPS/数字证书/数字签名</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;HTTP与HTTPS的不同点：&quot;&gt;&lt;a href=&quot;#HTTP与HTTPS的不同点：&quot; class=&quot;headerlink&quot; title=&quot;HTTP与HTTPS的不同点：&quot;&gt;&lt;/a&gt;HTTP与HTTPS的不同点：&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;1、HTTPS需要用到C
      
    
    </summary>
    
      <category term="技术" scheme="http://jiaxf.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="https" scheme="http://jiaxf.github.io/tags/https/"/>
    
      <category term="http" scheme="http://jiaxf.github.io/tags/http/"/>
    
      <category term="web" scheme="http://jiaxf.github.io/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>一次完整的http请求过程</title>
    <link href="http://jiaxf.github.io/2019/10/11/%E4%B8%80%E6%AC%A1%E5%AE%8C%E6%95%B4%E7%9A%84http%E8%AF%B7%E6%B1%82%E8%BF%87%E7%A8%8B/"/>
    <id>http://jiaxf.github.io/2019/10/11/一次完整的http请求过程/</id>
    <published>2019-10-11T01:33:01.000Z</published>
    <updated>2019-10-12T01:52:23.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一次完整的http请求过程"><a href="#一次完整的http请求过程" class="headerlink" title="一次完整的http请求过程"></a>一次完整的http请求过程</h1><p>当我们在web浏览器的地址栏中输入： <a href="http://www.google.com，然后回车，到底发生了什么？" target="_blank" rel="noopener">www.google.com，然后回车，到底发生了什么？</a></p><a id="more"></a><h2 id="过程概览"><a href="#过程概览" class="headerlink" title="过程概览"></a>过程概览</h2><pre><code>1.对www.google.com这个网址进行DNS域名解析，得到对应的IP地址2.根据这个IP，找到对应的服务器，发起TCP的三次握手3.建立TCP连接后发起HTTP请求4.服务器响应HTTP请求，浏览器得到html代码5.浏览器解析html代码，并请求html代码中的资源（如js、css图片等）（先得到html代码，才能去找这些资源）6.浏览器对页面进行渲染呈现给用户</code></pre><!-- more --> <h2 id="具体过程"><a href="#具体过程" class="headerlink" title="具体过程"></a>具体过程</h2><h3 id="1-域名解析"><a href="#1-域名解析" class="headerlink" title="1.域名解析"></a>1.域名解析</h3><p><img src="/img/dns解析过程.png" alt=""><img src="/img/dns查询过程.jpg" alt=""></p><p>DNS查询过程:浏览器缓存、系统缓存、hosts文件、野生DNS服务器（本地DNS服务器）、根DNS、顶级DNS、权威DNS、本地（附近）CDN、源站。</p><p>DNS优化:DNS缓存、DNS负载均衡</p><p>DNS请求是专门的dns协议，使用udp发送，因为是udp所以不需要建立连接。</p><h3 id="2-TCP连接"><a href="#2-TCP连接" class="headerlink" title="2.TCP连接"></a>2.TCP连接</h3><p><img src="/img/三次握手.png" alt="">  <img src="/img/四次挥手.png" alt=""></p><pre><code>1） Client首先发送一个连接试探，ACK=0 表示确认号无效，SYN = 1 表示这是一个连接请求或连接接受报文，同时表示这个数据报不能携带数据，seq = x 表示Client自己的初始序号（seq = 0 就代表这是第0号包），这时候Client进入syn_sent状态，表示客户端等待服务器的回复2） Server监听到连接请求报文后，如同意建立连接，则向Client发送确认。TCP报文首部中的SYN 和 ACK都置1 ，ack = x + 1表示期望收到对方下一个报文段的第一个数据字节序号是x+1，同时表明x为止的所有数据都已正确收到（ack=1其实是ack=0+1,也就是期望客户端的第1个包），seq = y 表示Server 自己的初始序号（seq=0就代表这是服务器这边发出的第0号包）。这时服务器进入syn_rcvd，表示服务器已经收到Client的连接请求，等待client的确认。3） Client收到确认后还需再次发送确认，同时携带要发送给Server的数据。ACK 置1 表示确认号ack= y + 1 有效（代表期望收到服务器的第1个包），Client自己的序号seq= x + 1（表示这就是我的第1个包，相对于第0个包来说的），一旦收到Client的确认之后，这个TCP连接就进入Established状态，就可以发起http请求了。注：SYN(synchronous建立联机)  ACK(acknowledgement 确认)  PSH(push传送)  FIN(finish结束) RST(reset重置) URG(urgent紧急) Sequence number(顺序号码) Acknowledge number(确认号码)</code></pre><p>建立连接，发起请求。<br>HTTP请求报文由三部分组成：请求行，请求头和请求正文</p><pre><code>请求行：用于描述客户端的请求方式，请求的资源名称以及使用的HTTP协议的版本号（例：GET/books/java.html HTTP/1.1）请求头：用于描述客户端请求哪台主机，以及客户端的一些环境信息等常见的请求报头有: Accept, Accept-Charset, Accept-Encoding, Accept-Language, Content-Type, Authorization, Cookie, User-Agent等。注：这里提一个请求头 Connection，Connection设置为 keep-alive用于说明 客户端这边设置的是，本次HTTP请求之后并不需要关闭TCP连接，这样可以使下次HTTP请求使用相同的TCP通道，节省TCP建立连接的时间请求正文：当使用POST, PUT等方法时，通常需要客户端向服务器传递数据。这些数据就储存在请求正文中（GET方式是保存在url地址后面，不会放到这里）</code></pre><h3 id="3-服务器响应"><a href="#3-服务器响应" class="headerlink" title="3.服务器响应"></a>3.服务器响应</h3><p>服务器端响应http请求，浏览器获取服务内容。<br>    HTTP响应也由三部分组成：状态码，响应头和实体内容</p><pre><code>状态码：状态码用于表示服务器对请求的处理结果</code></pre><p><img src="/img/状态码.png" alt=""></p><pre><code>列举几种常见的：            200：OK（没有问题）            206：Partial Content（客户端使用Content-Range指定了需要的实体数据的范围，然后服务端处理请求成功之后返回用户需要的这一部分数据而不是全部）            301：Moved Permanently（代表永久性定向。该状态码表示请求的资源已经被分配了新的URL，以后应该使用资源现在指定的URL）            302：Found（代表临时重定向。该状态码表示请求的资源已经被分配了新的URL，但是和301的区别是302代表的不是永久性的移动，只是临时的。）             304：Not Modifie（要你去拿缓存）             307：Temporary Redirect（临时重定向，与302相同，但是302会把POST改成GET，而307就不会。）            400：Bad Request(400表示请求报文中存在语法错误。需要修改后再次发送)            403：Forbidden（有表明请求访问的资源被拒绝了。没有获得服务器的访问权限，IP被禁止等。）            404：Not Found（服务器没有这个资源）            500：Internal Server Error（表明服务器端在执行请求时发生了错误，很有可能是服务端程序的Bug或故障）</code></pre><p><a href="http://tool.oschina.net/commons?type=5" target="_blank" rel="noopener">«状态码详见»</a></p><pre><code>若干响应头：响应头用于描述服务器的基本信息，以及客户端如何处理数据    Access-Control-Allow-Credentials: true    Access-Control-Allow-Headers: x-requested-with, Content-Type, Authorization,userId,token    Access-Control-Allow-Methods: POST, GET, OPTIONS, PUT, DELETE, PATCH    Access-Control-Allow-Origin: http://udig.iceshi.org    Access-Control-Expose-Headers: status    Access-Control-Max-Age: 3600    Content-Length: 612    Content-Type: application/json;charset=UTF-8    Date: Sat, 12 Oct 2019 01:32:33 GMT    Server: Apache-Coyote/1.1    XDomainRequestAllowed: 1实体内容：服务器返回给客户端的数据</code></pre><h3 id="4-浏览器解析"><a href="#4-浏览器解析" class="headerlink" title="4.浏览器解析"></a>4.浏览器解析</h3><p>浏览器拿到html文件后，就开始解析其中的html代码，遇到js/css/image等静态资源时，就向服务器端去请求下载（会使用多线程下载，每个浏览器的线程数不一样），这是时候就用上 keep-alive特性了，建立一次HTTP连接，可以请求多个资源，下载资源的顺序就是按照代码里面的顺序，但是由于每个资源大小不一样，而浏览器又是多线程请求请求资源，所以这里显示的顺序并不一定是代码里面的顺序。最后，浏览器利用自己内部的工作机制，把请求的静态资源和html代码进行渲染，渲染之后呈现给用户</p><p><img src="/img/页面渲染.png" alt=""></p><p>   浏览器如何对页面渲染？<br>    a）解析html文件构成 DOM树<br>    b）解析CSS文件构成渲染树<br>    c）边解析，边渲染<br>    d）JS的解析是由浏览器中的JS解析引擎完成的。JS单线程运行，JS有可能修改DOM结构，意味着JS执行完成前，后续所有资源的下载是没有必要的，所以JS是单线程，会阻塞后续资源下载</p><pre><code>浏览器是一个边解析边渲染的过程。首先浏览器解析HTML文件构建DOM树，然后解析CSS文件构建渲染树，等到渲染树构建完成后，浏览器开始布局渲染树并将其绘制到屏幕上涉及到两个概念: reflow(回流)和repain(重绘)。DOM节点中的各个元素都是以盒模型的形式存在，这些都需要浏览器去计算其位置和大小等，这个过程称为relow;当盒模型的位置,大小以及其他属性，如颜色,字体,等确定下来之后，浏览器便开始绘制内容，这个过程称为repain。页面在首次加载时必然会经历reflow和repain。reflow和repain过程是非常消耗性能的，尤其是在移动设备上，它会破坏用户体验，有时会造成页面卡顿。所以我们应该尽可能少的减少reflow和repain。</code></pre><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><blockquote><p>域名解析 –&gt; 发起TCP的3次握手 –&gt; 建立TCP连接后发起http请求 –&gt; 服务器响应http请求，浏览器得到html代码 –&gt; 浏览器解析html代码，并请求html代码中的资源（如js、css、图片等） –&gt; 浏览器对页面进行渲染呈现给用户</p></blockquote><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.cnblogs.com/xuzekun/p/7527736.html" target="_blank" rel="noopener">CSDN博客 一次完整的http请求过程</a></li><li><a href="https://www.cnblogs.com/engeng/articles/5959335.html" target="_blank" rel="noopener">CSDN博客一次完整的http请求</a></li><li><a href="https://www.cnblogs.com/engeng/articles/5943382.html" target="_blank" rel="noopener">从输入URL到页面加载发生了什么?</a></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;一次完整的http请求过程&quot;&gt;&lt;a href=&quot;#一次完整的http请求过程&quot; class=&quot;headerlink&quot; title=&quot;一次完整的http请求过程&quot;&gt;&lt;/a&gt;一次完整的http请求过程&lt;/h1&gt;&lt;p&gt;当我们在web浏览器的地址栏中输入： &lt;a href=&quot;http://www.google.com，然后回车，到底发生了什么？&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;www.google.com，然后回车，到底发生了什么？&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="技术" scheme="http://jiaxf.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="https" scheme="http://jiaxf.github.io/tags/https/"/>
    
      <category term="http" scheme="http://jiaxf.github.io/tags/http/"/>
    
      <category term="web" scheme="http://jiaxf.github.io/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>RServe安装配置</title>
    <link href="http://jiaxf.github.io/2018/11/22/RServe%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE2/"/>
    <id>http://jiaxf.github.io/2018/11/22/RServe高级配置2/</id>
    <published>2018-11-22T01:50:35.000Z</published>
    <updated>2019-10-11T03:54:17.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="RServe高级配置"><a href="#RServe高级配置" class="headerlink" title="RServe高级配置"></a>RServe高级配置</h1><p>##　1.RServe服务器启动</p><p>1） 在程序中，启动RServe服务器<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> library(Rserve)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> Rserve()</span></span><br></pre></td></tr></table></figure></p><p>2) 在命令行，启动RServe服务器<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">~ R CMD Rserve --help</span><br><span class="line"></span><br><span class="line">Usage: R CMD Rserve [&lt;options&gt;]</span><br><span class="line"></span><br><span class="line">Options: --help  this help screen</span><br><span class="line"> --version  prints Rserve version (also passed <span class="keyword">to</span> R)</span><br><span class="line"> --RS-port &lt;port&gt;  listen on the specified TCP port</span><br><span class="line"> --RS-socket &lt;socket&gt;  use specified local (unix) socket instead of TCP/IP.</span><br><span class="line"> --RS-workdir &lt;path&gt;  use specified working directory root <span class="keyword">for</span> connections.</span><br><span class="line"> --RS-encoding &lt;enc&gt;  <span class="builtin-name">set</span><span class="built_in"> default server </span>string encoding <span class="keyword">to</span> &lt;enc&gt;.</span><br><span class="line"> --RS-conf &lt;file&gt;  load additional<span class="built_in"> config </span>file.</span><br><span class="line"> --RS-settings  dumps current<span class="built_in"> settings </span>of the Rserve</span><br><span class="line"> --RS-source &lt;file&gt;  source the specified file on startup.</span><br><span class="line"> --RS-enable-control  <span class="builtin-name">enable</span> control commands</span><br><span class="line"> --RS-enable-remote  <span class="builtin-name">enable</span> remote connections</span><br><span class="line"> --RS-pidfile &lt;file&gt;  store the pid of the Rserve process <span class="keyword">in</span> &lt;file&gt;</span><br><span class="line"> --RS-<span class="builtin-name">set</span> &lt;config&gt;=&lt;value&gt;   <span class="builtin-name">set</span> configuration option as <span class="keyword">if</span> it was</span><br><span class="line">                             read <span class="keyword">from</span> a configuration file</span><br><span class="line"></span><br><span class="line">All other options are passed <span class="keyword">to</span> the R engine.</span><br></pre></td></tr></table></figure></p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">~ R <span class="keyword">CMD</span><span class="bash"> Rserve --RS-enable-remote</span></span><br></pre></td></tr></table></figure><h2 id="查看Rserve进程"><a href="#查看Rserve进程" class="headerlink" title="查看Rserve进程"></a>查看Rserve进程</h2><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">~ ps -aux|grep Rserve</span><br><span class="line">conan    <span class="number">27639</span>  <span class="number">0.0</span>  <span class="number">1.2</span> <span class="number">116288</span> <span class="number">25236</span> ?        Ss   <span class="number">20</span>:<span class="number">41</span>   <span class="number">0</span>:<span class="number">00</span> /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">R</span>/<span class="title">bin</span>/<span class="title">Rserve</span> --<span class="title">RS</span>-<span class="title">enable</span>-<span class="title">remote</span></span></span><br><span class="line"></span><br><span class="line">~ netstat -nltp|grep Rserve</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span>.<span class="number">0.0</span>:<span class="number">6311</span>            <span class="number">0.0</span>.<span class="number">0.0</span>:*               LISTEN      <span class="number">27639</span>/Rserve</span><br></pre></td></tr></table></figure><h2 id="2-Rserve配置"><a href="#2-Rserve配置" class="headerlink" title="2. Rserve配置"></a>2. Rserve配置</h2><p>通过配置文件，管理Rserve服务器。</p><p>Rserv.conf: 配置文件<br>source.R:初始化脚步文件<br>查看当前的Rserve 服务器的默认配置信息</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">~ R CMD Rserve --RS-settings</span><br><span class="line">Rserve v1.7-1</span><br><span class="line"></span><br><span class="line">config file: /etc/Rserv.conf</span><br><span class="line">working root: /tmp/Rserv</span><br><span class="line">port: 6311</span><br><span class="line">local socket: [none, TCP<span class="built_in">/IP </span>used]</span><br><span class="line">authorization required: <span class="literal">no</span></span><br><span class="line">plain text password: <span class="keyword">not</span> allowed</span><br><span class="line">passwords file: [none]</span><br><span class="line">allow I/O: <span class="literal">yes</span></span><br><span class="line">allow remote access: <span class="literal">no</span></span><br><span class="line">control commands: <span class="literal">no</span></span><br><span class="line">interactive: <span class="literal">yes</span></span><br><span class="line">max.input buffer size: 262144 kB</span><br></pre></td></tr></table></figure><p>修改默认配置，新建文件：/etc/Rserv.conf<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~ sudo vi /etc/Rserv.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  workdir /tmp/Rserv</span><br><span class="line">  remote enable</span><br><span class="line">  fileio enable</span><br><span class="line">  interactive <span class="literal">yes</span></span><br><span class="line"> <span class="built_in"> port </span>6311</span><br><span class="line">  maxinbuf 262144</span><br><span class="line">  encoding utf8</span><br><span class="line">  control enable</span><br><span class="line">  source /home/jiaxf/R/RServe/source.R</span><br><span class="line">  eval <span class="attribute">xx</span>=1</span><br><span class="line"></span><br><span class="line">  ~ vi /home/jiaxf/R/RServe/source.R</span><br><span class="line"></span><br><span class="line">    cat(<span class="string">"This is my Rserve!!"</span>)</span><br><span class="line">    <span class="builtin-name">print</span>(paste(<span class="string">"Server start at"</span>,Sys.time()))</span><br></pre></td></tr></table></figure></p><p>source选项，用来配置Rserve服务器启动时加载的文件，例如：初始化系统变量，初始化系统函数等。</p><p>eval选项，直接定义环境变量。</p><p>##　4. Rserve高级使用：用户登陆认证</p><p>增加用户登陆认证，修改文件：/etc/Rserv.conf<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">~ sudo vi /etc/Rserv.conf</span><br><span class="line"></span><br><span class="line">workdir /tmp/Rserv</span><br><span class="line">remote enable</span><br><span class="line">fileio enable</span><br><span class="line">interactive <span class="literal">yes</span></span><br><span class="line">port 6311</span><br><span class="line">maxinbuf 262144</span><br><span class="line">encoding utf8</span><br><span class="line">control enable</span><br><span class="line">source /home/jiaxf/R/RServe/source.R</span><br><span class="line">eval <span class="attribute">xx</span>=1</span><br><span class="line">auth required</span><br><span class="line">plaintext enable</span><br></pre></td></tr></table></figure></p><p>用RSclient登陆</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> library(RSclient)</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> conn&lt;-RS.connect()</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> RS.login(conn,<span class="string">"jiaxf"</span>,<span class="string">"jiaxf"</span>,authkey=RS.authkey(conn))</span></span><br><span class="line">[1] TRUE</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;RServe高级配置&quot;&gt;&lt;a href=&quot;#RServe高级配置&quot; class=&quot;headerlink&quot; title=&quot;RServe高级配置&quot;&gt;&lt;/a&gt;RServe高级配置&lt;/h1&gt;&lt;p&gt;##　1.RServe服务器启动&lt;/p&gt;
&lt;p&gt;1） 在程序中，启动RSer
      
    
    </summary>
    
      <category term="技术" scheme="http://jiaxf.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="R" scheme="http://jiaxf.github.io/tags/R/"/>
    
  </entry>
  
  <entry>
    <title>RServe安装配置</title>
    <link href="http://jiaxf.github.io/2018/11/22/RServe%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/"/>
    <id>http://jiaxf.github.io/2018/11/22/RServe安装配置/</id>
    <published>2018-11-22T01:07:04.000Z</published>
    <updated>2018-11-22T01:27:11.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="RServe安装配置"><a href="#RServe安装配置" class="headerlink" title="RServe安装配置"></a>RServe安装配置</h1><ol><li>Rserve的安装与配置<br>Rserve主要是提供远程连接的服务，当然功能是很多的，具体可参考：<a href="https://rforge.net/Rserve/" target="_blank" rel="noopener">https://rforge.net/Rserve/</a></li></ol><p>在安装Rserve之前确保R能够正常运行，并正确配置了R的环境变量。 建议安装R 3.2.5 以上的R版本。</p><h2 id="运行R，安装Rserve包"><a href="#运行R，安装Rserve包" class="headerlink" title="运行R，安装Rserve包"></a>运行R，安装Rserve包</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~ sudo R</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> install.packages(<span class="string">"Rserve"</span>)</span></span><br></pre></td></tr></table></figure><h2 id="查看Rserve配置"><a href="#查看Rserve配置" class="headerlink" title="查看Rserve配置"></a>查看Rserve配置</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">~ R CMD Rserve --RS-settings</span><br><span class="line">Rserve v1.7-3</span><br><span class="line"></span><br><span class="line">config file: /etc/Rserv.conf</span><br><span class="line">working root: /tmp/Rserv</span><br><span class="line">port: 6311</span><br><span class="line">local socket: [none, TCP<span class="built_in">/IP </span>used]</span><br><span class="line">authorization required: <span class="literal">no</span></span><br><span class="line">plain text password: <span class="keyword">not</span> allowed</span><br><span class="line">passwords file: [none]</span><br><span class="line">allow I/O: <span class="literal">yes</span></span><br><span class="line">allow remote access: <span class="literal">no</span></span><br><span class="line">control commands: <span class="literal">no</span></span><br><span class="line">interactive: <span class="literal">yes</span></span><br><span class="line">max.input buffer size: 262144 kB</span><br></pre></td></tr></table></figure><pre><code>config file: 本地无此文件/etc/Rserv.confworking root: R运行时工作目录 /tmp/Rservport: 端口6311local socket: TCP/IP协议authorization: 认证未开启plain text password: 不允许明文密码passwords file: 密码文件，未指定allow I/O: 允许IO操作allow remote access: 远程访问未开启control commands: 命令控制未开启interactive: 允许通信max.input buffer size: 文件上传限制262mb</code></pre><h2 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~ sudo <span class="keyword">vi</span> /etc/Rserv.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure><pre><code>workdir /tmp/Rservremote enablefileio enableauth requiredplaintext enablefileio enableinteractive yesport 6311maxinbuf 262144encoding utf8control enable</code></pre><h2 id="开启远程访问权限后配置信息"><a href="#开启远程访问权限后配置信息" class="headerlink" title="开启远程访问权限后配置信息"></a>开启远程访问权限后配置信息</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">~ R CMD Rserve --RS-settings</span><br><span class="line">Rserve v1.7-3</span><br><span class="line"></span><br><span class="line">config file: /etc/Rserv.conf</span><br><span class="line">working root: /tmp/Rserv</span><br><span class="line">port: 6311</span><br><span class="line">local socket: [none, TCP<span class="built_in">/IP </span>used]</span><br><span class="line">authorization required: <span class="literal">yes</span></span><br><span class="line">plain text password: allowed</span><br><span class="line">passwords file: [none]</span><br><span class="line">allow I/O: <span class="literal">yes</span></span><br><span class="line">allow remote access: <span class="literal">yes</span></span><br><span class="line">control commands: <span class="literal">yes</span></span><br><span class="line">interactive: <span class="literal">yes</span></span><br><span class="line">max.input buffer size: 262144 kB</span><br></pre></td></tr></table></figure><h2 id="指定配置文件"><a href="#指定配置文件" class="headerlink" title="指定配置文件"></a>指定配置文件</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~ R <span class="keyword">CMD</span><span class="bash"> Rserve --RS-conf /etc/Rserv.conf</span></span><br></pre></td></tr></table></figure><h2 id="启动Rserve远程模式"><a href="#启动Rserve远程模式" class="headerlink" title="启动Rserve远程模式"></a>启动Rserve远程模式</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~ R <span class="keyword">CMD</span><span class="bash"> Rserve --RS-enable-remote</span></span><br></pre></td></tr></table></figure><h2 id="查看启动后Rserve端口"><a href="#查看启动后Rserve端口" class="headerlink" title="查看启动后Rserve端口"></a>查看启动后Rserve端口</h2><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~ netstat -nltp|<span class="type">grep</span> Rserve</span><br></pre></td></tr></table></figure><blockquote><p>tcp  0   0 0.0.0.0:6311   0.0.0.0:*   LISTEN  73821/Rserve</p><p>0.0.0.0:6311 代表不受限的IP访问</p></blockquote><ol start="2"><li>Java远程连接Rserve</li></ol><p>首先，我们需要下载Rserve所使用到的两个Jar包：REngine.jar和RserveEngine.jar，下载地址<a href="http://www.rforge.net/Rserve/files/" target="_blank" rel="noopener">http://www.rforge.net/Rserve/files/</a><br>如果项目使用maven进行管理，那么将下面的内容放入pom.xml文件中：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.rosuda.REngine<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>REngine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.rosuda.REngine<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Rserve<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">```</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;RServe安装配置&quot;&gt;&lt;a href=&quot;#RServe安装配置&quot; class=&quot;headerlink&quot; title=&quot;RServe安装配置&quot;&gt;&lt;/a&gt;RServe安装配置&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;Rserve的安装与配置&lt;br&gt;Rserve主要是提供远程连接的
      
    
    </summary>
    
      <category term="技术" scheme="http://jiaxf.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="R" scheme="http://jiaxf.github.io/tags/R/"/>
    
  </entry>
  
  <entry>
    <title>R语言初步</title>
    <link href="http://jiaxf.github.io/2018/11/20/R%E8%AF%AD%E8%A8%80%E5%88%9D%E6%AD%A5/"/>
    <id>http://jiaxf.github.io/2018/11/20/R语言初步/</id>
    <published>2018-11-20T05:20:07.000Z</published>
    <updated>2018-11-22T01:23:18.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="R语言初步"><a href="#R语言初步" class="headerlink" title="R语言初步"></a>R语言初步</h1><p>常用R对象</p><ul><li>向量</li><li>列表</li><li>矩阵</li><li>数组</li><li>因子</li><li>数据帧</li></ul><p>向量对象有六种数据类型的原子向量，也称为六类向量。 其他R对象是建立在原子向量之上的。六类向量类型如下表所示</p><p><img src="/img/R1.png" alt=""></p><h2 id="向量"><a href="#向量" class="headerlink" title="向量"></a>向量</h2><p>当要创建具有多个元素的向量时，应该使用<code>c()</code>函数，表示将元素组合成一个向量。</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create a vector.</span></span><br><span class="line">apple &lt;- c(<span class="string">'red'</span>,<span class="string">'green'</span>,<span class="string">"yellow"</span>);</span><br><span class="line"><span class="built_in">print</span>(apple);</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get the class of the vector.</span></span><br><span class="line"><span class="built_in">print</span>(<span class="class"><span class="keyword">class</span>(<span class="title">apple</span>));</span></span><br></pre></td></tr></table></figure><p>R上面示例代码，执行结果如下<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> apple &lt;- c(<span class="string">'red'</span>,<span class="string">'green'</span>,<span class="string">"yellow"</span>);</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">print</span>(apple);</span></span><br><span class="line">[1] "red"    "green"  "yellow"</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">print</span>(class(apple));</span></span><br><span class="line">[1] "character"</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure></p><h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><p>列表是一个R对象，它可以包含许多不同类型的元素，如向量，函数，甚至其中的另一个列表。<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Create a <span class="type">list</span>.</span><br><span class="line">list1 &lt;- <span class="type">list</span>(c(<span class="number">2</span>,<span class="number">5</span>,<span class="number">3</span>),<span class="number">21.3</span>,sin);</span><br><span class="line"></span><br><span class="line"># Print the <span class="type">list</span>.</span><br><span class="line">print(list1);</span><br></pre></td></tr></table></figure></p><p>R上面示例代码，执行结果如下<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">[[1]]</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">2</span> <span class="number">5</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="string">[[2]]</span></span><br><span class="line">[<span class="number">1</span>] <span class="number">21.3</span></span><br><span class="line"></span><br><span class="line"><span class="string">[[3]]</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="params">(x)</span></span>  .Primitive(<span class="string">"sin"</span>)</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;R语言初步&quot;&gt;&lt;a href=&quot;#R语言初步&quot; class=&quot;headerlink&quot; title=&quot;R语言初步&quot;&gt;&lt;/a&gt;R语言初步&lt;/h1&gt;&lt;p&gt;常用R对象&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;向量&lt;/li&gt;
&lt;li&gt;列表&lt;/li&gt;
&lt;li&gt;矩阵&lt;/li&gt;
&lt;li&gt;数组&lt;
      
    
    </summary>
    
      <category term="技术" scheme="http://jiaxf.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="R" scheme="http://jiaxf.github.io/tags/R/"/>
    
  </entry>
  
  <entry>
    <title>Let&#39;s Encrypt通配符证书开启HTTPS</title>
    <link href="http://jiaxf.github.io/2018/06/12/Let&#39;s%20Encrypt%E9%80%9A%E9%85%8D%E7%AC%A6%E8%AF%81%E4%B9%A6%E5%BC%80%E5%90%AFHTTPS/"/>
    <id>http://jiaxf.github.io/2018/06/12/Let&#39;s Encrypt通配符证书开启HTTPS/</id>
    <published>2018-06-12T07:50:50.000Z</published>
    <updated>2018-06-13T07:43:07.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Let’s-Encrypt通配符证书开启HTTPS"><a href="#Let’s-Encrypt通配符证书开启HTTPS" class="headerlink" title="Let’s Encrypt通配符证书开启HTTPS"></a>Let’s Encrypt通配符证书开启HTTPS</h1><h2 id="什么是Let’s-Encrypt"><a href="#什么是Let’s-Encrypt" class="headerlink" title="什么是Let’s Encrypt?"></a>什么是Let’s Encrypt?</h2><p>部署 HTTPS 网站的时候需要证书，证书由 CA 机构签发，大部分传统 CA 机构签发证书是需要收费的，这不利于推动 HTTPS 协议的使用。</p><p>Let’s Encrypt 也是一个 CA 机构，但这个 CA 机构是免费的！也就是说签发证书不需要任何费用。</p><h2 id="什么是通配符证书"><a href="#什么是通配符证书" class="headerlink" title="什么是通配符证书"></a>什么是通配符证书</h2><p>在没有出现通配符证书之前，Let’s Encrypt 支持两种证书。</p><p>1）单域名证书：证书仅仅包含一个主机。</p><p>2）SAN 证书：一张证书可以包括多个主机（Let’s Encrypt 限制是 20），也就是证书可以包含下列的主机：<a href="http://www.example.com、www.example.cn、blog.example.com" target="_blank" rel="noopener">www.example.com、www.example.cn、blog.example.com</a> 等等。</p><p>证书包含的主机可以不是同一个注册域，不要问我注册域是什么？注册域就是向域名注册商购买的域名。</p><p>对于个人用户来说，由于主机并不是太多，所以使用 SAN 证书完全没有问题，但是对于大公司来说有一些问题：</p><p>子域名非常多，而且过一段时间可能就要使用一个新的主机。</p><p>注册域也非常多。</p><p>读者可以思考下，对于大企业来说，SAN 证书可能并不能满足需求，类似于 sina 这样的网站，所有的主机全部包含在一张证书中，而使用 Let’s Encrypt 证书是无法满足的。</p><h2 id="Let’s-Encrypt-通配符证书"><a href="#Let’s-Encrypt-通配符证书" class="headerlink" title="Let’s Encrypt 通配符证书"></a>Let’s Encrypt 通配符证书</h2><p>通配符证书就是证书中可以包含一个通配符，比如 .example.com、.example.cn，读者很快明白，大型企业也可以使用通配符证书了，一张证书可以防止更多的主机了。</p><p>这个功能可以说非常重要，从功能上看 Let’s Encrypt 和传统 CA 机构没有什么区别了，会不会触动传统 CA 机构的利益呢？</p><h2 id="如何申请Let’s-Encrypt通配符证书"><a href="#如何申请Let’s-Encrypt通配符证书" class="headerlink" title="如何申请Let’s Encrypt通配符证书"></a>如何申请Let’s Encrypt通配符证书</h2><p>为了实现通配符证书，Let’s Encrypt 对 ACME 协议的实现进行了升级，只有 v2 协议才能支持通配符证书。</p><p>也就是说任何客户端只要支持 ACME v2 版本，就可以申请通配符证书了，是不是很激动。</p><p>读者可以查看下自己惯用的客户端是不是支持 ACME v2 版本，官方介绍 Certbot 0.22.0 版本支持新的协议版本，我立刻进行了升级：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./certbot-auto -V</span><br><span class="line">Upgrading certbot-auto <span class="number">0.21</span><span class="number">.1</span> to <span class="number">0.22</span><span class="number">.0</span>...</span><br><span class="line">Replacing certbot-auto...</span><br><span class="line"></span><br><span class="line">./certbot-auto -V</span><br><span class="line">certbot <span class="number">0.22</span><span class="number">.0</span></span><br></pre></td></tr></table></figure></p><p>在了解该协议之前有几个注意点：</p><p>1）客户在申请 Let’s Encrypt 证书的时候，需要校验域名的所有权，证明操作者有权利为该域名申请证书，目前支持三种验证方式：</p><p>dns-01：给域名添加一个 DNS TXT 记录。</p><p>http-01：在域名对应的 Web 服务器下放置一个 HTTP well-known URL 资源文件。</p><p>tls-sni-01：在域名对应的 Web 服务器下放置一个 HTTPS well-known URL 资源文件。</p><p>而申请通配符证书，只能使用 dns-01 的方式。</p><p>2）ACME v2 和 v1 协议是互相不兼容的，为了使用 v2 版本，客户端需要创建另外一个账户（代表客户端操作者），以 Certbot 客户端为例，大家可以查看：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ tree /etc/letsencrypt/accounts</span><br><span class="line">.</span><br><span class="line">├── acme-staging<span class="selector-class">.api</span><span class="selector-class">.letsencrypt</span><span class="selector-class">.org</span></span><br><span class="line">└── acme-v01<span class="selector-class">.api</span><span class="selector-class">.letsencrypt</span><span class="selector-class">.org</span></span><br></pre></td></tr></table></figure></p><p>3）Enumerable Orders 和限制</p><p>为了实现通配符证书，Let’s Encrypt 在申请者身份校验上做了很大的改变。</p><p>有了订单 ID 的概念，主要是为了追踪通配符域名。</p><p>申请限制，在 V1 版本，Let’s Encrypt 为了避免滥操作，对申请证书有一些限制（很难学习，但是正常使用不会遇到该限制）。而 v2 版本，对于通配符证书，多了一个限制，New Orders per Account（每个证书订单数限制）。</p><p>这两个细节，后续再仔细研究。</p><h2 id="实践测试"><a href="#实践测试" class="headerlink" title="实践测试"></a>实践测试</h2><p>我迫不及待想使用 Certbot 申请通配符证书，升级 Certbot 版本运行下列命令：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ certbot-auto certonly  -d *.newyingyong.cn --manual --preferred-challenges dns</span><br><span class="line"></span><br><span class="line">Saving <span class="builtin-name">debug</span> log <span class="keyword">to</span> /var/log/letsencrypt/letsencrypt.log</span><br><span class="line">Plugins selected: Authenticator manual, Installer None</span><br><span class="line">Obtaining a new certificate</span><br><span class="line">The currently selected ACME CA endpoint does <span class="keyword">not</span> support issuing wildcard certificates.</span><br></pre></td></tr></table></figure><p>参数说明：</p><p>certonly，插件，Certbot 有很多插件，不同的插件都可以申请证书，用户可以根据需要自行选择<br>-d 为那些主机申请证书，如果是通配符，输入 *.newyingyong.cn<br>–preferred-challenges dns，使用 DNS 方式校验域名所有权<br>接下去就是命令行的输出：</p><figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Saving debug log <span class="keyword">to</span> /var/log/letsencrypt/letsencrypt.log</span><br><span class="line">Plugins selected: Authenticator manual, Installer None</span><br><span class="line">Enter email address (used <span class="keyword">for</span> urgent renewal <span class="keyword">and</span> security notices) (Enter <span class="symbol">'c</span>' <span class="keyword">to</span></span><br><span class="line">cancel): ywdblog@gmail.com</span><br><span class="line"></span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------</span></span><br><span class="line">Please read the Terms <span class="keyword">of</span> Service at</span><br><span class="line">https://letsencrypt.org/documents/LE-SA-v1.<span class="number">2</span>-November-<span class="number">15</span>-<span class="number">2017</span>.pdf. You must</span><br><span class="line">agree <span class="keyword">in</span> order <span class="keyword">to</span> <span class="keyword">register</span> <span class="keyword">with</span> the ACME server at</span><br><span class="line">https://acme-v02.api.letsencrypt.org/directory</span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------</span></span><br><span class="line">(A)gree/(C)ancel: A</span><br><span class="line"></span><br><span class="line">Plugins selected: Authenticator manual, Installer None</span><br><span class="line">Obtaining a <span class="keyword">new</span> certificate</span><br><span class="line">Performing the following challenges:</span><br><span class="line">dns-<span class="number">01</span> challenge <span class="keyword">for</span> newyingyong.cn</span><br><span class="line"></span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------</span></span><br><span class="line"><span class="literal">NOTE</span>: The IP <span class="keyword">of</span> this machine will be publicly logged as having requested this</span><br><span class="line">certificate. <span class="keyword">If</span> you<span class="symbol">'re</span> running certbot <span class="keyword">in</span> manual mode <span class="keyword">on</span> a machine that <span class="keyword">is</span> <span class="keyword">not</span></span><br><span class="line">your server, please ensure you<span class="symbol">'re</span> okay <span class="keyword">with</span> that.</span><br><span class="line"></span><br><span class="line">Are you OK <span class="keyword">with</span> your IP being logged?</span><br><span class="line"><span class="comment">-------------------------------------------------------------------------------</span></span><br><span class="line">(Y)es/(N)o: y</span><br></pre></td></tr></table></figure><p>上述有两个交互式的提示：</p><p>是否同意 Let’s Encrypt 协议要求</p><p>询问是否对域名和机器（IP）进行绑定</p><p>确认同意才能继续。</p><p>继续查看命令行的输出，非常关键：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Please deploy a<span class="built_in"> DNS </span>TXT record under the name</span><br><span class="line">_acme-challenge.newyingyong.cn with the following value:</span><br><span class="line"></span><br><span class="line">2_8KBE_jXH8nYZ2unEViIbW52LhIqxkg6i9mcwsRvhQ</span><br><span class="line"></span><br><span class="line">Before continuing, verify the record is deployed.</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Press Enter <span class="keyword">to</span> Continue</span><br><span class="line">Waiting <span class="keyword">for</span> verification<span class="built_in">..</span>.</span><br><span class="line">Cleaning up challenges</span><br></pre></td></tr></table></figure><p>要求配置 DNS TXT 记录，从而校验域名所有权，也就是判断证书申请者是否有域名的所有权。</p><p>上面输出要求给 _acme-challenge.newyingyong.cn 配置一条 TXT 记录，在没有确认 TXT 记录生效之前不要回车执行。</p><p>我使用的是阿里云的域名服务器，登录控制台操作如下图：</p><p><img src="/img/alidns.png" alt=""></p><p>然后输入下列命令确认 TXT 记录是否生效：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ dig  -t txt  _acme-challenge.newyingyong.cn @<span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span>    </span><br><span class="line"></span><br><span class="line">;; OPT <span class="string">PSEUDOSECTION:</span></span><br><span class="line">; <span class="string">EDNS:</span> <span class="string">version:</span> <span class="number">0</span>, <span class="string">flags:</span>; <span class="string">udp:</span> <span class="number">512</span></span><br><span class="line">;; QUESTION <span class="string">SECTION:</span></span><br><span class="line">;_acme-challenge.newyingyong.cn.        IN      TXT</span><br><span class="line"></span><br><span class="line">;; ANSWER <span class="string">SECTION:</span></span><br><span class="line">_acme-challenge.newyingyong.cn. <span class="number">599</span> IN  TXT     <span class="string">"2_8KBE_jXH8nYZ2unEViIbW52LhIqxkg6i9mcwsRvhQ"</span></span><br></pre></td></tr></table></figure><p>确认生效后，回车执行，输出如下：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">IMPORTANT <span class="string">NOTES:</span></span><br><span class="line"> - Congratulations! Your certificate and chain have been saved <span class="string">at:</span></span><br><span class="line">   <span class="regexp">/etc/</span>letsencrypt<span class="regexp">/live/</span>newyingyong.cn/fullchain.pem</span><br><span class="line">   Your key file has been saved <span class="string">at:</span></span><br><span class="line">   <span class="regexp">/etc/</span>letsencrypt<span class="regexp">/live/</span>newyingyong.cn/privkey.pem</span><br><span class="line">   Your cert will expire on <span class="number">2018</span><span class="number">-06</span><span class="number">-12.</span> To obtain a <span class="keyword">new</span> or tweaked</span><br><span class="line">   version of <span class="keyword">this</span> certificate <span class="keyword">in</span> the future, simply run certbot-auto</span><br><span class="line">   again. To non-interactively renew *all* of your certificates, run</span><br><span class="line">   <span class="string">"certbot-auto renew"</span></span><br><span class="line"> - If you like Certbot, please consider supporting our work <span class="string">by:</span></span><br><span class="line"></span><br><span class="line">   Donating to ISRG <span class="regexp">/ Let's Encrypt:   https:/</span><span class="regexp">/letsencrypt.org/</span>donate</span><br><span class="line">   Donating to <span class="string">EFF:</span>                    <span class="string">https:</span><span class="comment">//eff.org/donate-le</span></span><br></pre></td></tr></table></figure><p>恭喜您，证书申请成功，证书和密钥保存在下列目录：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ tree /etc/letsencrypt/archive/newyingyong.cn</span><br><span class="line">.</span><br><span class="line">├── cert1.pem</span><br><span class="line">├── chain1.pem</span><br><span class="line">├── fullchain1.pem</span><br><span class="line">└── privkey1.pem</span><br></pre></td></tr></table></figure><p>然后校验证书信息，输入如下命令：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -<span class="keyword">in</span>  <span class="regexp">/etc/</span>letsencrypt<span class="regexp">/archive/</span>newyingyong.cn<span class="regexp">/cert1.pem -noout -text</span></span><br></pre></td></tr></table></figure></p><p>关键输出如下：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Authority Information <span class="string">Access:</span></span><br><span class="line">        OCSP - <span class="string">URI:</span><span class="string">http:</span><span class="comment">//ocsp.int-x3.letsencrypt.org</span></span><br><span class="line">        CA Issuers - <span class="string">URI:</span><span class="string">http:</span><span class="comment">//cert.int-x3.letsencrypt.org/</span></span><br><span class="line"></span><br><span class="line">X509v3 Subject Alternative <span class="string">Name:</span></span><br><span class="line"><span class="symbol">    DNS:</span>*.newyingyong.cn</span><br></pre></td></tr></table></figure></p><p>完美，证书包含了 SAN 扩展，该扩展的值就是 *.newyingyong.cn。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Let’s-Encrypt通配符证书开启HTTPS&quot;&gt;&lt;a href=&quot;#Let’s-Encrypt通配符证书开启HTTPS&quot; class=&quot;headerlink&quot; title=&quot;Let’s Encrypt通配符证书开启HTTPS&quot;&gt;&lt;/a&gt;Let’s Encry
      
    
    </summary>
    
    
      <category term="技术" scheme="http://jiaxf.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="https" scheme="http://jiaxf.github.io/tags/https/"/>
    
      <category term="Let&#39;s Encrypt" scheme="http://jiaxf.github.io/tags/Let-s-Encrypt/"/>
    
  </entry>
  
  <entry>
    <title>获取Let&#39;s Encrypt免费通配符证书实现Https</title>
    <link href="http://jiaxf.github.io/2018/06/12/%E8%8E%B7%E5%8F%96Let&#39;sEncrypt%E5%85%8D%E8%B4%B9%E8%AF%81%E4%B9%A6/"/>
    <id>http://jiaxf.github.io/2018/06/12/获取Let&#39;sEncrypt免费证书/</id>
    <published>2018-06-12T07:19:50.000Z</published>
    <updated>2018-06-13T05:35:14.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="获取Let’s-Encrypt免费通配符证书实现Https"><a href="#获取Let’s-Encrypt免费通配符证书实现Https" class="headerlink" title="获取Let’s Encrypt免费通配符证书实现Https"></a>获取Let’s Encrypt免费通配符证书实现Https</h1><p>3月14日，Let’s Encrypt的执行董事Josh Aas对外宣布，他们的通配符证书正式上线，用户可以基于此特性轻松部署/开启所有子域名的HTTPS功能。</p><p>Let’s Encrypt 是国外一个公共的免费SSL项目，由 Linux 基金会托管，它的来头不小，由 Mozilla、思科、Akamai、IdenTrust 和 EFF 等组织发起，目的就是向网站自动签发和管理免费证书，以便加速互联网由 HTTP 过渡到 HTTPS，目前 Facebook 等大公司开始加入赞助行列。</p><p>Let’s Encrypt 已经得了 IdenTrust 的交叉签名，这意味着其证书现在已经可以被 Mozilla、Google、Microsoft 和 Apple 等主流的浏览器所信任，用户只需要在 Web 服务器证书链中配置交叉签名，浏览器客户端会自动处理好其它的一切，Let’s Encrypt 安装简单，使用非常方便。</p><h2 id="Linux下获取证书生成工具certbot"><a href="#Linux下获取证书生成工具certbot" class="headerlink" title="Linux下获取证书生成工具certbot"></a>Linux下获取证书生成工具certbot</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="comment">//dl.eff.org/certbot-auto</span></span><br><span class="line">chmod a+x certbot-<span class="keyword">auto</span></span><br></pre></td></tr></table></figure><h2 id="获取证书"><a href="#获取证书" class="headerlink" title="获取证书"></a>获取证书</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shell <span class="string">./certbot-auto</span> certonly -d *.你的域名 <span class="params">--manual</span> <span class="params">--preferred-challenges</span> dns <span class="params">--server</span> https:<span class="string">//acme-v02.api.letsencrypt.org/directory</span></span><br></pre></td></tr></table></figure><p>上述有三个交互式的提示：</p><p>是否同意 Let’s Encrypt 协议要求<br>询问是否对域名和机器（IP）进行绑定<br>输入邮箱，给你发送一封验证邮件<br>确认同意才能继续。</p><p>继续查看命令行的输出，非常关键：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Please deploy a<span class="built_in"> DNS </span>TXT record under the name</span><br><span class="line">_acme-challenge.xxx.cn with the following value:</span><br><span class="line"></span><br><span class="line">2_8KBE_jXH8nYZ2unEViIbW52LhIqxkg6i9mcwsRvhQ</span><br><span class="line"></span><br><span class="line">Before continuing, verify the record is deployed.</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Press Enter <span class="keyword">to</span> Continue</span><br><span class="line">Waiting <span class="keyword">for</span> verification<span class="built_in">..</span>.</span><br><span class="line">Cleaning up challenges</span><br></pre></td></tr></table></figure><p>要求给 _acme-challenge.xxx.cn 配置一条 TXT 记录，在没有确认 TXT 记录生效之前不要回车执行。</p><p>然后输入下列命令确认 TXT 记录是否生效：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ dig  -t txt  _acme-challenge.xxx.cn @<span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span>    </span><br><span class="line"></span><br><span class="line">;; OPT <span class="string">PSEUDOSECTION:</span></span><br><span class="line">; <span class="string">EDNS:</span> <span class="string">version:</span> <span class="number">0</span>, <span class="string">flags:</span>; <span class="string">udp:</span> <span class="number">512</span></span><br><span class="line">;; QUESTION <span class="string">SECTION:</span></span><br><span class="line">;_acme-challenge.xxx.cn.        IN      TXT</span><br><span class="line"></span><br><span class="line">;; ANSWER <span class="string">SECTION:</span></span><br><span class="line">_acme-challenge.xxx.cn. <span class="number">599</span> IN  TXT     <span class="string">"2_8KBE_jXH8nYZ2unEViIbW52LhIqxkg6i9mcwsRvhQ"</span></span><br></pre></td></tr></table></figure><p>确认生效后，回车执行</p><p>恭喜您，证书申请成功，证书和密钥保存在下列目录：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ tree /etc/letsencrypt/archive/xxx.cn</span><br><span class="line">.</span><br><span class="line">├── cert1.pem</span><br><span class="line">├── chain1.pem</span><br><span class="line">├── fullchain1.pem</span><br><span class="line">└── privkey1.pem</span><br></pre></td></tr></table></figure><h2 id="证书更新"><a href="#证书更新" class="headerlink" title="证书更新"></a>证书更新</h2><p>证书有效期为三个月，到期之前需要更新证书，更新流程就是重新执行一遍上面的操作，新证书会在你申请证书的日期上加三个月。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;获取Let’s-Encrypt免费通配符证书实现Https&quot;&gt;&lt;a href=&quot;#获取Let’s-Encrypt免费通配符证书实现Https&quot; class=&quot;headerlink&quot; title=&quot;获取Let’s Encrypt免费通配符证书实现Https&quot;&gt;&lt;/a
      
    
    </summary>
    
    
      <category term="技术" scheme="http://jiaxf.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="https" scheme="http://jiaxf.github.io/tags/https/"/>
    
  </entry>
  
  <entry>
    <title>Redis数据介绍与指令大全</title>
    <link href="http://jiaxf.github.io/2018/05/24/Redis%E6%95%B0%E6%8D%AE%E4%BB%8B%E7%BB%8D%E4%B8%8E%E6%8C%87%E4%BB%A4%E5%A4%A7%E5%85%A8/"/>
    <id>http://jiaxf.github.io/2018/05/24/Redis数据介绍与指令大全/</id>
    <published>2018-05-24T07:41:56.000Z</published>
    <updated>2018-05-24T07:55:56.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Redis数据介绍与指令大全"><a href="#Redis数据介绍与指令大全" class="headerlink" title="Redis数据介绍与指令大全"></a>Redis数据介绍与指令大全</h1><p>作为 Key-value 型数据库,Redis 也提供了键(Key)和键值(Value)的映射关系。但是,除了常规的数值或字符串,Redis 的键值还可以是以下形式之一:</p><ul><li>Lists (列表)</li><li>Sets (集合)</li><li>Sorted sets (有序集合)</li><li>Hashes (哈希表)</li></ul><h2 id="适用场景"><a href="#适用场景" class="headerlink" title="适用场景"></a>适用场景</h2><ol><li>取最新的n个数据，如读取作家博客最新的50篇文章，通过List实现按时间排序的数据的高效获取</li><li>排行榜应用，以特定条件为排序标准，将其设成sorted set 的score，进而实现高效获取</li><li>需要精准设定过期时间的应用，把sorted set 的 score 值设置成过期时间的时间戳,那么就可以简单地通过过期时间排序,定时清除过期数据了</li><li>计数器应用，Redis 的命令都是原子性的,可以轻松地利用 INCR,DECR 命令来构建计数器系统。</li><li>去除大量数据中的重复数据，将数据放入set中，就能实现对重复数据的排除</li><li>构建队列系统使用 list 可以构建队列系统,使用 sorted set 甚至可以构建有优先级的队列系统。</li><li>实时系统,反垃圾系统通过上面说到的 set 功能,你可以知道一个终端用户是否进行了某个操作,可以找到其操作的集合并进行分析统计对比等。</li><li>Pub/Sub构建实时消息系统</li><li>缓存</li></ol><h2 id="redis数据类型及操作详解"><a href="#redis数据类型及操作详解" class="headerlink" title="redis数据类型及操作详解"></a>redis数据类型及操作详解</h2><h3 id="1-strings类型及操作"><a href="#1-strings类型及操作" class="headerlink" title="1. strings类型及操作"></a>1. strings类型及操作</h3><p><img src="/images/string.png" alt=""></p><h3 id="2-hashes类型及操作"><a href="#2-hashes类型及操作" class="headerlink" title="2. hashes类型及操作"></a>2. hashes类型及操作</h3><p>Redis hash 是一个 string 类型的 field 和 value 的映射表，hash 特别适合用于存储对象,相较string,由于使用了zipmap而占用更少的内存</p><p>操作方法：</p><p><img src="/images/hash.png" alt=""></p><h3 id="3-list类型及操作"><a href="#3-list类型及操作" class="headerlink" title="3. list类型及操作"></a>3. list类型及操作</h3><p>list 底层实现是一个双向链表，最大长度为2^32,也可用作栈</p><p>操作方法：</p><p><img src="/images/list.png" alt=""></p><h3 id="4-set类型及操作"><a href="#4-set类型及操作" class="headerlink" title="4. set类型及操作"></a>4. set类型及操作</h3><p>set 是 string 类型的无序集合。set 元素最大可以包含(2 的 32 次方)个元素。set 的是通过 hash table 实现的，hash table 会随着添加或者删除自动的调整大小。调整 hash table 大小时候需要同步(获取写锁)会阻塞其他读写操作。</p><p>操作方法：</p><p><img src="/images/set.png" alt=""></p><h3 id="5-sorted-sets-类型及操作"><a href="#5-sorted-sets-类型及操作" class="headerlink" title="5. sorted sets 类型及操作"></a>5. sorted sets 类型及操作</h3><p>sorted set 在set的基础上增加了一个标识属性，它可以在set添加或修改元素时指定，每次指定，set会自动按标识调整顺序，set的每一个元素都会关联一个double类型的score。使用时往往我们把要排序的字段作为score存储，对象id则作为元素存储。</p><p>操作方法：</p><p><img src="/images/sortedset.png" alt=""></p><h2 id="redis-常用命令"><a href="#redis-常用命令" class="headerlink" title="redis 常用命令"></a>redis 常用命令</h2><h3 id="1-键值相关命令"><a href="#1-键值相关命令" class="headerlink" title="1. 键值相关命令"></a>1. 键值相关命令</h3><p><img src="/images/clientcmd.png" alt=""></p><h3 id="2-服务器相关命令"><a href="#2-服务器相关命令" class="headerlink" title="2. 服务器相关命令"></a>2. 服务器相关命令</h3><p><img src="/images/servercmd.png" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Redis数据介绍与指令大全&quot;&gt;&lt;a href=&quot;#Redis数据介绍与指令大全&quot; class=&quot;headerlink&quot; title=&quot;Redis数据介绍与指令大全&quot;&gt;&lt;/a&gt;Redis数据介绍与指令大全&lt;/h1&gt;&lt;p&gt;作为 Key-value 型数据库,Redi
      
    
    </summary>
    
    
      <category term="技术" scheme="http://jiaxf.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="redis" scheme="http://jiaxf.github.io/tags/redis/"/>
    
      <category term="缓存" scheme="http://jiaxf.github.io/tags/%E7%BC%93%E5%AD%98/"/>
    
  </entry>
  
  <entry>
    <title>redis常用命令总结</title>
    <link href="http://jiaxf.github.io/2018/05/24/redis%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/"/>
    <id>http://jiaxf.github.io/2018/05/24/redis常用命令总结/</id>
    <published>2018-05-24T07:26:22.000Z</published>
    <updated>2018-05-24T07:43:56.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="redis常用命令总结"><a href="#redis常用命令总结" class="headerlink" title="redis常用命令总结"></a>redis常用命令总结</h1><h2 id="一、key-pattern-查询相应的key"><a href="#一、key-pattern-查询相应的key" class="headerlink" title="一、key pattern 查询相应的key"></a>一、key pattern 查询相应的key</h2><p>　　（1）redis允许模糊查询key　　有3个通配符  <code>*、?、[]`</code></p><p>　　（2）randomkey：返回随机key　　</p><p>　　（3）type key：返回key存储的类型</p><p>　　（4）exists key：判断某个key是否存在</p><p>　　（5）del key：删除key</p><p>　　（6）rename key newkey：改名</p><p>　　（7）renamenx key newkey：如果newkey不存在则修改成功</p><p>　　（8）move key 1：将key移动到1数据库</p><p>　　（9）ttl key：查询key的生命周期（秒）</p><p>　　（10）expire key 整数值：设置key的生命周期以秒为单位</p><p>　　（11）pexpire key 整数值：设置key的生命周期以毫秒为单位</p><p>　　（12）pttl key：查询key 的生命周期（毫秒）</p><p>　　（13）perisist key：把指定key设置为永久有效</p><h2 id="二、字符串类型的操作"><a href="#二、字符串类型的操作" class="headerlink" title="二、字符串类型的操作"></a>二、字符串类型的操作</h2><p>　　（1）set key value [ex 秒数] [px 毫秒数] [nx/xx]　　</p><p>　　　　　　如果ex和px同时写，则以后面的有效期为准</p><p>　　　　　　nx：如果key不存在则建立</p><p>　　　　　　xx：如果key存在则修改其值</p><p>　　（2）get key：取值</p><p>　　（3）mset key1 value1 key2 value2 一次设置多个值</p><p>　　（4）mget key1 key2 ：一次获取多个值</p><p>　　（5）setrange key offset value：把字符串的offset偏移字节改成value</p><p>　　　　　　　　　　　　　　　　　　如果偏移量 &gt; 字符串长度，该字符自动补0x00</p><p>　　（6）append key value ：把value追加到key 的原值上</p><p>　　（7）getrange key start stop：获取字符串中[start, stop]范围的值</p><p>　　　　　　　　　　　　　　　　　　对于字符串的下标，左数从0开始，右数从-1开始</p><p>　　　　　　　　　　　　　　　　　　注意：当start&gt;length，则返回空字符串</p><p>　　　　　　　　　　　　　　　　　　　　　当stop&gt;=length，则截取至字符串尾</p><p>　　　　　　　　　　　　　　　　　　　　　如果start所处位置在stop右边，则返回空字符串</p><p>　　（8）getset key nrevalue：获取并返回旧值，在设置新值</p><p>　　（9）incr key：自增，返回新值，如果incr一个不是int的value则返回错误，incr一个不存在的key，则设置key为1</p><p>　　（10）incrby key 2：跳2自增</p><p>　　（11）incrbyfloat by 0.7： 自增浮点数　</p><p>　　（12）setbit key offset value：设置offset对应二进制上的值，返回该位上的旧值</p><p>注意：如果offset过大，则会在中间填充0</p><p>　　　offset最大到多少</p><p>　　　2^32-1，即可推出最大的字符串为512M</p><p>　　（13）bitop operation destkey key1 [key2..]    对key1 key2做opecation并将结果保存在destkey上</p><p>　　　　　　　　　　　　　　　　　　　　　　　　　　opecation可以是AND OR NOT XOR</p><p>　　（14）strlen key：取指定key的value值的长度</p><p>　  （15）setex key time value：设置key对应的值value，并设置有效期为time秒</p><h2 id="三、链表操作"><a href="#三、链表操作" class="headerlink" title="三、链表操作"></a>三、链表操作</h2><p>　　Redis的list类型其实就是一个每个子元素都是string类型的双向链表，链表的最大长度是2^32。list既可以用做栈，也可以用做队列。</p><p>　　list的pop操作还有阻塞版本，主要是为了避免轮询</p><p>　　（1）lpush key value：把值插入到链表头部</p><p>　　（2）rpush key value：把值插入到链表尾部</p><p>　　（3）lpop key ：返回并删除链表头部元素</p><p>　　（4）rpop key： 返回并删除链表尾部元素</p><p>　　（5）lrange key start stop：返回链表中[start, stop]中的元素</p><p>　　（6）lrem key count value：从链表中删除value值，删除count的绝对值个value后结束</p><p>　　　　　　　　　　　　　　　　count &gt; 0 从表头删除　　count &lt; 0 从表尾删除　　count=0 全部删除</p><p>　　（7）ltrim key start stop：剪切key对应的链接，切[start, stop]一段并把改制重新赋给key</p><p>　　（8）lindex key index：返回index索引上的值</p><p>　　（9）llen key：计算链表的元素个数</p><p>　　（10）linsert key after|before search value：在key 链表中寻找search，并在search值之前|之后插入value</p><p>　　（11）rpoplpush source dest：把source 的末尾拿出，放到dest头部，并返回单元值</p><p>　　　　应用场景： task + bak 双链表完成安全队列</p><p>　业务逻辑： rpoplpush task bak</p><p>　　　　　　　　　接收返回值并做业务处理</p><p>　　　　　　　　　如果成功则rpop bak清除任务，如果不成功，下次从bak表取任务</p><p>　　（12）brpop，blpop key timeout：等待弹出key的尾/头元素</p><p>　　　　　　　　　　　　　　　　timeout为等待超时时间，如果timeout为0则一直等待下去</p><p>　　　　　　应用场景：长轮询ajax，在线聊天时能用到</p><h2 id="四、hashes类型及操作"><a href="#四、hashes类型及操作" class="headerlink" title="四、hashes类型及操作"></a>四、hashes类型及操作</h2><p>　　Redis hash 是一个string类型的field和value的映射表，它的添加、删除操作都是O(1)（平均）。hash特别适用于存储对象，将一个对象存储在hash类型中会占用更少的内存，并且可以方便的存取整个对象。</p><p>　　配置： hash_max_zipmap_entries 64 #配置字段最多64个</p><p>　　　　　 hash_max_zipmap_value 512 #配置value最大为512字节</p><p>　　（1）hset myhash field value：设置myhash的field为value</p><p>　　（2）hsetnx myhash field value：不存在的情况下设置myhash的field为value</p><p>　　（3）hmset myhash field1 value1 field2 value2：同时设置多个field</p><p>　　（4）hget myhash field：获取指定的hash field</p><p>　　（5）hmget myhash field1 field2：一次获取多个field</p><p>　　（6）hincrby myhash field 5：指定的hash field加上给定的值</p><p>　　（7）hexists myhash field：测试指定的field是否存在</p><p>　　（8）hlen myhash：返回hash的field数量</p><p>　　（9）hdel myhash field：删除指定的field</p><p>　　（10）hkeys myhash：返回hash所有的field</p><p>　　（11）hvals myhash：返回hash所有的value</p><p>　　（12）hgetall myhash：获取某个hash中全部的field及value　</p><p>##　五、集合结构操作</p><p>　　特点：无序性、确定性、唯一性</p><p>　　（1）sadd key value1 value2：往集合里面添加元素</p><p>　　（2）smembers key：获取集合所有的元素</p><p>　　（3）srem key value：删除集合某个元素</p><p>　　（4）spop key：返回并删除集合中1个随机元素（可以坐抽奖，不会重复抽到某人）　　　</p><p>　　（5）srandmember key：随机取一个元素</p><p>　　（6）sismember key value：判断集合是否有某个值</p><p>　　（7）scard key：返回集合元素的个数</p><p>　　（8）smove source dest value：把source的value移动到dest集合中</p><p>　　（9）sinter key1 key2 key3：求key1 key2 key3的交集</p><p>　　（10）sunion key1 key2：求key1 key2 的并集</p><p>　　（11）sdiff key1 key2：求key1 key2的差集</p><p>　　（12）sinterstore res key1 key2：求key1 key2的交集并存在res里　</p><h2 id="六、有序集合"><a href="#六、有序集合" class="headerlink" title="六、有序集合"></a>六、有序集合</h2><p>　　概念：它是在set的基础上增加了一个顺序属性，这一属性在添加修改元素的时候可以指定，每次指定后，zset会自动按新的值调整顺序。可以理解为有两列的mysql表，一列存储value，一列存储顺序，操作中key理解为zset的名字。</p><p>　　和set一样sorted，sets也是string类型元素的集合，不同的是每个元素都会关联一个double型的score。sorted set的实现是skip list和hash table的混合体。</p><p>　　当元素被添加到集合中时，一个元素到score的映射被添加到hash table中，所以给定一个元素获取score的开销是O(1)。另一个score到元素的映射被添加的skip list，并按照score排序，所以就可以有序地获取集合中的元素。添加、删除操作开销都是O(logN)和skip list的开销一致，redis的skip list 实现是双向链表，这样就可以逆序从尾部去元素。sorted set最经常使用方式应该就是作为索引来使用，我们可以把要排序的字段作为score存储，对象的ID当元素存储。</p><p>　　（1）zadd key score1 value1：添加元素</p><p>　　（2）zrange key start stop [withscore]：把集合排序后,返回名次[start,stop]的元素  默认是升续排列  withscores 是把score也打印出来</p><p>　　（3）zrank key member：查询member的排名（升序0名开始）</p><p>　　（4）zrangebyscore key min max [withscores] limit offset N：集合（升序）排序后取score在[min, max]内的元素，并跳过offset个，取出N个</p><p>　　（5）zrevrank key member：查询member排名（降序 0名开始）</p><p>　　（6）zremrangebyscore key min max：按照score来删除元素，删除score在[min, max]之间</p><p>　　（7）zrem key value1 value2：删除集合中的元素</p><p>　　（8）zremrangebyrank key start end：按排名删除元素，删除名次在[start, end]之间的</p><p>　　（9）zcard key：返回集合元素的个数</p><p>　　（10）zcount key min max：返回[min, max]区间内元素数量</p><p>　　（11）zinterstore dest numkeys key1[key2..] [WEIGHTS weight1 [weight2…]] [AGGREGATE SUM|MIN|MAX]</p><p>　　　　　　求key1，key2的交集，key1，key2的权值分别是weight1，weight2</p><p>　　　　　　聚合方法用 sum|min|max</p><p>　　　　　　聚合结果 保存子dest集合内</p><p>　　　　　　注意：weights,aggregate如何理解？</p><p>答：如果有交集，交集元素又有score，score怎么处理？aggregate num-&gt;score相加，min最小score，max最大score，另外可以通过weights设置不同的key的权重，交集时  score*weight</p><h2 id="七、服务器相关命令"><a href="#七、服务器相关命令" class="headerlink" title="七、服务器相关命令"></a>七、服务器相关命令</h2><p>　　（1）ping：测定连接是否存活</p><p>　　（2）echo：在命令行打印一些内容</p><p>　　（3）select：选择数据库</p><p>　　（4）quit：退出连接</p><p>　　（5）dbsize：返回当前数据库中key的数目</p><p>　　（6）info：获取服务器的信息和统计</p><p>　　（7）monitor：实时转储收到的请求</p><p>　　（8）config get 配置项：获取服务器配置的信息</p><p>　　　　 config set 配置项  值：设置配置项信息</p><p>　　（9）flushdb：删除当前选择数据库中所有的key</p><p>　　（10）flushall：删除所有数据库中的所有的key</p><p>　　（11）time：显示服务器时间，时间戳（秒），微秒数</p><p>　　（12）bgrewriteaof：后台保存rdb快照</p><p>　　（13）bgsave：后台保存rdb快照</p><p>　　（14）save：保存rdb快照</p><p>　　（15）lastsave：上次保存时间</p><p>　　（16）shutdown [save/nosave]</p><p>　　注意：如果不小心运行了flushall，立即shutdown nosave，关闭服务器，然后手工编辑aof文件，去掉文件中的flushall相关行，然后开启服务器，就可以倒回原来是数据。如果flushall之后，系统恰好bgwriteaof了，那么aof就清空了，数据丢失。</p><p>　　（17）showlog：显示慢查询</p><p>　　　　　　问：多慢才叫慢？</p><p>　　　　　　答：由slowlog-log-slower-than 10000，来指定（单位为微秒）</p><p>　　　　　　问：服务器存储多少条慢查询记录</p><p>　　　　　　答：由slowlog-max-len 128，来做限制　　　　　　　</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;redis常用命令总结&quot;&gt;&lt;a href=&quot;#redis常用命令总结&quot; class=&quot;headerlink&quot; title=&quot;redis常用命令总结&quot;&gt;&lt;/a&gt;redis常用命令总结&lt;/h1&gt;&lt;h2 id=&quot;一、key-pattern-查询相应的key&quot;&gt;&lt;a hr
      
    
    </summary>
    
    
      <category term="技术" scheme="http://jiaxf.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="redis" scheme="http://jiaxf.github.io/tags/redis/"/>
    
      <category term="缓存" scheme="http://jiaxf.github.io/tags/%E7%BC%93%E5%AD%98/"/>
    
  </entry>
  
  <entry>
    <title>redis通配符删除</title>
    <link href="http://jiaxf.github.io/2018/05/24/redis%E9%80%9A%E9%85%8D%E7%AC%A6%E5%88%A0%E9%99%A4/"/>
    <id>http://jiaxf.github.io/2018/05/24/redis通配符删除/</id>
    <published>2018-05-24T07:14:45.000Z</published>
    <updated>2018-05-24T07:44:04.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="redis通配符删除"><a href="#redis通配符删除" class="headerlink" title="redis通配符删除"></a>redis通配符删除</h1><h2 id="批量删除Key"><a href="#批量删除Key" class="headerlink" title="批量删除Key"></a>批量删除Key</h2><p>Redis 中有删除单个 Key 的指令 DEL，但好像没有批量删除 Key 的指令，不过我们可以借助 Linux 的 xargs 指令来完成这个动作</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-<span class="keyword">cli</span> keys <span class="string">"*"</span> | xargs redis-<span class="keyword">cli</span> del</span><br></pre></td></tr></table></figure><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如果要指定 Redis 数据库访问密码，使用下面的命令</span></span><br><span class="line">redis-<span class="keyword">cli</span> -a password keys <span class="string">"*"</span> | xargs redis-<span class="keyword">cli</span> -a password del  </span><br><span class="line"></span><br><span class="line"><span class="comment">//下面的命令指定数据序号为0，即默认数据库  </span></span><br><span class="line">redis-<span class="keyword">cli</span> -<span class="keyword">n</span> 0 keys <span class="string">"*"</span> | xargs redis-<span class="keyword">cli</span> -<span class="keyword">n</span> 0 del</span><br></pre></td></tr></table></figure><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//批量删除redis 数据库中redis key的方法如下：</span></span><br><span class="line">bin/redis-cli  –h <span class="params">&lt;your_redis_server_IP&gt;</span></span><br><span class="line">                -p  <span class="number">6379</span>  -n  <span class="params">&lt;your database ID&gt;</span></span><br><span class="line">                -a  <span class="params">&lt;your_auth_keys&gt;</span>  keys  <span class="string">"mykeys*"</span>  |  xargs bin/redis-cli -n <span class="params">&lt;your database ID&gt;</span> del</span><br></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除所有Key，可以使用Redis的flushdb和flushall命令</span></span><br><span class="line"><span class="comment">//删除当前数据库中的所有Key  </span></span><br><span class="line">flushdb  </span><br><span class="line"><span class="comment">//删除所有数据库中的key  </span></span><br><span class="line">flushall</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;redis通配符删除&quot;&gt;&lt;a href=&quot;#redis通配符删除&quot; class=&quot;headerlink&quot; title=&quot;redis通配符删除&quot;&gt;&lt;/a&gt;redis通配符删除&lt;/h1&gt;&lt;h2 id=&quot;批量删除Key&quot;&gt;&lt;a href=&quot;#批量删除Key&quot; class
      
    
    </summary>
    
    
      <category term="技术" scheme="http://jiaxf.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="redis" scheme="http://jiaxf.github.io/tags/redis/"/>
    
      <category term="缓存" scheme="http://jiaxf.github.io/tags/%E7%BC%93%E5%AD%98/"/>
    
  </entry>
  
  <entry>
    <title>程序猿灯谜</title>
    <link href="http://jiaxf.github.io/2018/05/04/%E7%A8%8B%E5%BA%8F%E7%8C%BF%E7%81%AF%E8%B0%9C/"/>
    <id>http://jiaxf.github.io/2018/05/04/程序猿灯谜/</id>
    <published>2018-05-04T08:24:04.000Z</published>
    <updated>2018-05-04T09:04:08.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="灯谜"><a href="#灯谜" class="headerlink" title="灯谜"></a>灯谜</h1><ol><li><p>老会计喝二锅（打一热门技术）</p></li><li><p>梦中交谈（打一热门技术）</p></li><li><p>连胜六场又赢了（打一知名操作系统）</p></li><li><p>小米大合唱（打一著名互联网厂商）</p></li><li><p>男女生都一样（打一技术术语）</p></li><li><p>不达目的誓不罢休（打一著名网络解决方案提供商）</p></li><li><p>席卷天下，包举宇内，囊括四海，并吞八荒（打一互联网技术）</p></li><li><p>话又说回来了（打一网络安全术语）</p></li><li><p>禽流感（打一常见的PC/服务器故障）</p></li><li><p>深夜造访（打一网络安全术语）</p></li><li><p>屡屡破记录（打一技术术语）</p></li><li><p>单个花生超产（打一芯片技术）</p></li><li><p>驴友上路多郁闷（打一网络设备）</p></li><li><p>月老难扯二人姻缘（打一网络技术）</p></li><li><p>光芒照四方（打一安全厂商）</p></li><li><p>网管抓狂（打一网络设备）</p></li><li><p>悟空出了五指山（打一技术术语）</p></li><li><p>不听话就得打（打一网络安全术语）</p></li><li><p>整个界面都是阿凡达（打一PC/服务器故障现象）</p></li><li><p>E（打一开发语言）</p></li><li><p>拳王的金腰带（打一网络技术）</p></li><li><p>方便月老配对象（打一网络设备）</p></li><li><p>走麦城（打一网络安全设备）</p></li><li><p>皇帝绷着脸（打一设备）</p></li><li><p>太上老君的金丹（打一网络安全术语）</p></li><li><p>王老吉面壁（打一网络安全设备）</p></li></ol><a id="more"></a><p>谜底</p><ol><li><p>老会计喝二锅（打一热门技术）—— 云计算</p></li><li><p>梦中交谈（打一热门技术）—— 虚拟化</p></li><li><p>连胜六场又赢了（打一知名操作系统）—— Win7</p></li><li><p>小米大合唱（打一著名互联网厂商）—— 谷歌</p></li><li><p>男女生都一样（打一技术术语）—— 兼容性</p></li><li><p>不达目的誓不罢休（打一著名网络解决方案提供商）—— 思科</p></li><li><p>席卷天下，包举宇内，囊括四海，并吞八荒（打一互联网技术）—— 广域网</p></li><li><p>话又说回来了（打一网络安全术语） —— 循环语句</p></li><li><p>禽流感（打一常见的PC/服务器故障）—— 死机</p></li><li><p>深夜造访（打一网络安全术语） —— 黑客</p></li><li><p>屡屡破记录（打一技术术语）—— 超频</p></li><li><p>单个花生超产（打一芯片技术） —— 多核</p></li><li><p>驴友上路多郁闷（打一网络设备）—— 路由器</p></li><li><p>月老难扯二人姻缘（打一网络技术）—— 无线</p></li><li><p>光芒照四方（打一安全厂商）—— 金山</p></li><li><p>网管抓狂（打一网络设备）—— 网卡</p></li><li><p>悟空出了五指山（打一技术术语）—— 解压</p></li><li><p>不听话就得打（打一网络安全术语）—— 拒绝服务攻击</p></li><li><p>整个界面都是阿凡达（打一PC/服务器故障现象）—— 蓝屏</p></li><li><p>E（打一开发语言）—— C++</p></li><li><p>拳王的金腰带（打一网络技术）—— 宽带</p></li><li><p>方便月老配对象（打一网络设备）—— 集线器</p></li><li><p>走麦城（打一网络安全设备）—— 网关</p></li><li><p>皇帝绷着脸（打一设备）—— 主板</p></li><li><p>太上老君的金丹（打一网络安全术语）—— 密钥</p></li><li><p>王老吉面壁（打一网络安全设备）—— 防火墙</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;灯谜&quot;&gt;&lt;a href=&quot;#灯谜&quot; class=&quot;headerlink&quot; title=&quot;灯谜&quot;&gt;&lt;/a&gt;灯谜&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;老会计喝二锅（打一热门技术）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;梦中交谈（打一热门技术）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;连胜六场又赢了（打一知名操作系统）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;小米大合唱（打一著名互联网厂商）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;男女生都一样（打一技术术语）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;不达目的誓不罢休（打一著名网络解决方案提供商）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;席卷天下，包举宇内，囊括四海，并吞八荒（打一互联网技术）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;话又说回来了（打一网络安全术语）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;禽流感（打一常见的PC/服务器故障）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;深夜造访（打一网络安全术语）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;屡屡破记录（打一技术术语）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;单个花生超产（打一芯片技术）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;驴友上路多郁闷（打一网络设备）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;月老难扯二人姻缘（打一网络技术）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;光芒照四方（打一安全厂商）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;网管抓狂（打一网络设备）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;悟空出了五指山（打一技术术语）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;不听话就得打（打一网络安全术语）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;整个界面都是阿凡达（打一PC/服务器故障现象）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;E（打一开发语言）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;拳王的金腰带（打一网络技术）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;方便月老配对象（打一网络设备）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;走麦城（打一网络安全设备）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;皇帝绷着脸（打一设备）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;太上老君的金丹（打一网络安全术语）&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;王老吉面壁（打一网络安全设备）&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="生活乐趣" scheme="http://jiaxf.github.io/tags/%E7%94%9F%E6%B4%BB%E4%B9%90%E8%B6%A3/"/>
    
  </entry>
  
  <entry>
    <title>高性能web平台OpenResty</title>
    <link href="http://jiaxf.github.io/2018/05/04/%E9%AB%98%E6%80%A7%E8%83%BDweb%E5%B9%B3%E5%8F%B0OpenResty/"/>
    <id>http://jiaxf.github.io/2018/05/04/高性能web平台OpenResty/</id>
    <published>2018-05-04T06:38:17.000Z</published>
    <updated>2018-05-04T08:15:55.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="高性能web平台OpenResty"><a href="#高性能web平台OpenResty" class="headerlink" title="高性能web平台OpenResty"></a>高性能web平台OpenResty</h1><h2 id="OpenResty®"><a href="#OpenResty®" class="headerlink" title="OpenResty®"></a>OpenResty®</h2><p>OpenResty® 是一个基于 Nginx 与 Lua 的高性能 Web 平台，其内部集成了大量精良的 Lua 库、第三方模块以及大多数的依赖项。用于方便地搭建能够处理超高并发、扩展性极高的动态 Web 应用、Web 服务和动态网关。</p><p>OpenResty® 通过汇聚各种设计精良的 Nginx 模块（主要由 OpenResty 团队自主开发），从而将 Nginx 有效地变成一个强大的通用 Web 应用平台。这样，Web 开发人员和系统工程师可以使用 Lua 脚本语言调动 Nginx 支持的各种 C 以及 Lua 模块，快速构造出足以胜任 10K 乃至 1000K 以上单机并发连接的高性能 Web 应用系统。</p><p>OpenResty® 的目标是让你的Web服务直接跑在 Nginx 服务内部，充分利用 Nginx 的非阻塞 I/O 模型，不仅仅对 HTTP 客户端请求,甚至于对远程后端诸如 MySQL、PostgreSQL、Memcached 以及 Redis 等都进行一致的高性能响应。</p><p>OpenResty(又称：ngx_openresty) 是一个基于 NGINX 的可伸缩的 Web 平台，由中国人章亦春发起，提供了很多高质量的第三方模块。<br>OpenResty 是一个强大的 Web 应用服务器，Web 开发人员可以使用 Lua 脚本语言调动 Nginx 支持的各种 C 以及 Lua 模块,更主要的是在性能方面，OpenResty可以 快速构造出足以胜任 10K 以上并发连接响应的超高性能 Web 应用系统。</p><h2 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h2><h3 id="macOS-Mac-OS-X"><a href="#macOS-Mac-OS-X" class="headerlink" title="macOS/Mac OS X"></a>macOS/Mac OS X</h3><p>强烈建议 Mac OS X 或者 macOS 系统用户通过 homebrew 包管理器安装 OpenResty，像下面这样：</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span>tap openresty/<span class="keyword">brew</span></span><br><span class="line"><span class="keyword">brew </span>install openresty</span><br></pre></td></tr></table></figure><p>如果你之前是从 homebrew/nginx 安装的 OpenResty，请先执行：</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span>untap homebrew/nginx</span><br></pre></td></tr></table></figure><h1 id="Hello-World实例"><a href="#Hello-World实例" class="headerlink" title="Hello World实例"></a>Hello World实例</h1><p>安装成功后，可以使用openresty直接输出html页面。<br>首先可以创建一个工作目录<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /<span class="built_in">home</span>/www</span><br><span class="line">cd /<span class="built_in">home</span>/www/</span><br><span class="line"><span class="built_in">mkdir</span> logs/ conf/</span><br></pre></td></tr></table></figure></p><p>其中，logs目录用于存放日志，conf用于存放配置文件。</p><p>在conf目录下创建一个nginx.conf文件 代码如下：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">worker_processes</span>  <span class="number">1</span>;</span><br><span class="line"><span class="attribute">error_log</span> logs/error.log;</span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    <span class="attribute">worker_connections</span> <span class="number">1024</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">9000</span>;</span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">default_type</span> text/html;</span><br><span class="line">            <span class="attribute">content_by_lua</span> <span class="string">'</span></span><br><span class="line"><span class="string">                ngx.say("&lt;p&gt;Hello, World!&lt;/p&gt;")</span></span><br><span class="line"><span class="string">            '</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="启动openresty"><a href="#启动openresty" class="headerlink" title="启动openresty"></a>启动openresty</h2><p>默认情况下 openresty 安装在 /usr/local/openresty 目录中，启动命令为:<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="regexp">/home/</span>www</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/openresty/</span>nginx<span class="regexp">/sbin/</span>nginx -p `pwd`<span class="regexp">/ -c conf/</span>nginx.conf</span><br></pre></td></tr></table></figure></p><p>如果没有任何输出，说明启动成功，-p 指定我们的项目目录，-c 指定配置文件。</p><p>接下来我们可以使用 curl 来测试是否能够正常范围：</p><p><code>curl http://localhost:9000/</code></p><p>输出结果为：</p><p><code>&lt;p&gt;Hello, World!&lt;/p&gt;</code></p><p>OpenResty 的目标是让你的 Web 服务直接跑在 Nginx 服务内部,充分利用 Nginx 的非阻塞 I/O 模型,不仅仅对 HTTP 客户端请求,甚至于对远程后端诸如 MySQL,PostgreSQL,~Memcaches 以及 ~Redis 等都进行一致的高性能响应。<br>所以对于一些高性能的服务来说，可以直接使用 OpenResty 访问 Mysql或Redis等，而不需要通过第三方语言（PHP、Python、Ruby）等来访问数据库再返回，这大大提高了应用的性能。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;高性能web平台OpenResty&quot;&gt;&lt;a href=&quot;#高性能web平台OpenResty&quot; class=&quot;headerlink&quot; title=&quot;高性能web平台OpenResty&quot;&gt;&lt;/a&gt;高性能web平台OpenResty&lt;/h1&gt;&lt;h2 id=&quot;OpenR
      
    
    </summary>
    
    
      <category term="技术" scheme="http://jiaxf.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="服务器" scheme="http://jiaxf.github.io/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>对称加密&amp;非对称加密</title>
    <link href="http://jiaxf.github.io/2018/05/03/%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86&amp;%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/"/>
    <id>http://jiaxf.github.io/2018/05/03/对称加密&amp;非对称加密/</id>
    <published>2018-05-03T01:27:09.000Z</published>
    <updated>2018-05-03T02:17:25.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="对称加密-DES"><a href="#对称加密-DES" class="headerlink" title="对称加密 - DES"></a>对称加密 - DES</h1><ol><li>真正的加密算法，带密钥，加密和解密使用相同的密钥</li><li>对称加密优点是算法公开、计算量小、加密速度快、加密效率高</li><li>双方都保存秘钥，其次如果一方的秘钥被泄露，那么加密信息也就不安全了。另外，每对用户每次使用对称加密算法时，都需要使用其他人不知道的唯一秘钥，这会使得收、发双方所拥有的钥匙数量巨大，密钥管理成为双方的负担</li><li>DES使用56位密钥，以现代计算能力，24小时内即可被破解。虽然如此，在某些简单应用中，我们还是可以使用DES加密算法</li></ol><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DES</span> </span>&#123;  </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加密</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> datasource byte[]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password   String</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> byte[]</span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] encrypt(<span class="keyword">byte</span>[] datasource, String password) &#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">              SecureRandom random = <span class="keyword">new</span> SecureRandom();  </span><br><span class="line">              DESKeySpec desKey = <span class="keyword">new</span> DESKeySpec(password.getBytes());  </span><br><span class="line">              <span class="comment">//创建一个密匙工厂，然后用它把DESKeySpec转换成  </span></span><br><span class="line">              SecretKeyFactory keyFactory = SecretKeyFactory.getInstance(<span class="string">"DES"</span>);  </span><br><span class="line">              SecretKey securekey = keyFactory.generateSecret(desKey);  </span><br><span class="line">              <span class="comment">//Cipher对象实际完成加密操作  </span></span><br><span class="line">              Cipher cipher = Cipher.getInstance(<span class="string">"DES"</span>);  </span><br><span class="line">              <span class="comment">//用密匙初始化Cipher对象,Cipher.ENCRYPT_MODE代表编码模式  </span></span><br><span class="line">              cipher.init(Cipher.ENCRYPT_MODE, securekey, random);  </span><br><span class="line">              <span class="comment">//现在，获取数据并加密  </span></span><br><span class="line">              <span class="comment">//正式执行加密操作  </span></span><br><span class="line">              <span class="function"><span class="keyword">return</span> cipher.<span class="title">doFinal</span><span class="params">(datasource)</span></span>;  </span><br><span class="line">          &#125; <span class="keyword">catch</span> (Throwable e) &#123;  </span><br><span class="line">              e.printStackTrace();  </span><br><span class="line">          &#125;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解密</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> src      byte[]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password String</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> byte[]</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] decrypt(<span class="keyword">byte</span>[] src, String password) <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">      <span class="comment">// DES算法要求有一个可信任的随机数源  </span></span><br><span class="line">      SecureRandom random = <span class="keyword">new</span> SecureRandom();  </span><br><span class="line">      <span class="comment">// 创建一个DESKeySpec对象  </span></span><br><span class="line">      DESKeySpec desKey = <span class="keyword">new</span> DESKeySpec(password.getBytes());  </span><br><span class="line">      <span class="comment">// 创建一个密匙工厂  </span></span><br><span class="line">      SecretKeyFactory keyFactory = SecretKeyFactory.getInstance(<span class="string">"DES"</span>);  </span><br><span class="line">      <span class="comment">// 将DESKeySpec对象转换成SecretKey对象  </span></span><br><span class="line">      SecretKey securekey = keyFactory.generateSecret(desKey);  </span><br><span class="line">      <span class="comment">// Cipher对象实际完成解密操作  </span></span><br><span class="line">      Cipher cipher = Cipher.getInstance(<span class="string">"DES"</span>);  </span><br><span class="line">      <span class="comment">// 用密匙初始化Cipher对象  </span></span><br><span class="line">      cipher.init(Cipher.DECRYPT_MODE, securekey, random);  </span><br><span class="line">      <span class="comment">// 真正开始解密操作  </span></span><br><span class="line">      <span class="function"><span class="keyword">return</span> cipher.<span class="title">doFinal</span><span class="params">(src)</span></span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="非对称加密-RSA"><a href="#非对称加密-RSA" class="headerlink" title="非对称加密 - RSA"></a>非对称加密 - RSA</h1><p>1、用RSA算法生成一对密钥，公钥发放给外部客户，私钥自己保管；有以下应用场景：<br>     【公钥加密、私钥解密】或者【私钥签名、公钥验证】<br>2、非对称加解密的理解：</p><ul><li>小明想秘密给小英发送消息</li><li>小英手里有一个盒子（public key），这个盒子只有小英手里的钥匙（private key）才打得开</li><li>小英把盒子送给小明（分发公钥）</li><li>小明写好消息放进盒子里，锁上盒子（公钥加密）</li><li>小明把盒子寄给小英（密文传输）</li><li>小英用手里的钥匙打开盒子，得到小明的消息（私钥解密）</li><li>假设小刚劫持了盒子，因为没有小英的钥匙，他也打不开</li></ul><p>与DES不同，RSA算法中，每个通信主体都有两个钥匙，一个公钥一个私钥。<br>就是有2把钥匙</p><ol><li>使用publicKey可以对数据进行加密</li><li>使用Key才能对数据进行解密</li></ol><p>单方向传输<br>用公钥加密的数据，只有私钥能解开（可用于加密）；<br>同时，使用私钥加密的数据，只有公钥能解开（签名）。但是速度很慢（比私钥加密慢100到1000倍），<br>公钥的主要算法有RSA，还包括Blowfish,Diffie-Helman等。</p><p>公钥与私钥</p><ol><li>权威数字认证机构（CA）给所有通信主体（个人或组织）颁发公钥和私钥，彼此配对，分别唯一。</li><li>私钥好比数字指纹，同时具有解密和加密功能。个人保管，不公开。</li><li>公钥好比安全性极高的挂号信箱地址，公开。</li></ol><p><em>公私钥加解密举例</em></p><p><img src="/images/20160122203001725.jpeg" alt=""></p><p>设若甲有一份需保密的数字商业合同发给乙签署。经过如下步骤：</p><ol><li>甲用乙的公钥对合同加密。</li><li>密文从甲发送到乙。</li><li>乙收到密文，并用自己的私钥对其解密。</li><li>解密正确，经阅读，乙用自己的私钥对合同进行签署。</li><li>乙用甲的公钥对已经签署的合同进行加密。</li><li>乙将密文发给甲。</li><li>甲用自己的私钥将已签署合同解密。</li><li>解密正确，确认签署。</li></ol><p>公私钥加解密说明<br>从以上步骤，我们知道：</p><ol><li>用公钥加密的密文能且只能用与其唯一配对的私钥才能解开。</li><li>如果某份密文被解开，那么肯定是密文的目标信息主体解开的。</li><li>私钥因其唯一标识所有者的属性，被用于数字签名，具有法律效力。</li></ol><p>一。 公私钥生成</p><ol><li>随机选定两个大素数p, q.</li><li>计算公钥和私钥的公共模数 n = pq .</li><li>计算模数n的欧拉函数 φ(n) .</li><li>选定一个正整数e, 使1 &lt; e &lt; φ(n) , 且e与φ(n)互质.</li><li>计算d, 满足 de ≡ 1  (mod φ(n) ), (k为某个正整数).<br>6.n与e决定公钥, n与d决定私钥.</li></ol><p>二。加解密<br>该过程为小张给小李发消息，公钥为小李的公钥(n &amp; e), 私钥为小李的私钥(n &amp; d).</p><ol><li>小张欲给小李发一个消息M, 他先把M转换为一个大数m &lt; n, 然后用小李的公钥(n &amp; e)把m加密为另一个大数:<br>c = me    mod n</li><li>小李收到小张发来的大数c, 着手解密. 通过自己的私钥(n &amp; d), 得到原来的大数m:<br>m = cd    mod n<br>3.再把m转换为M, 小李即得到小张的原始消息.</li></ol><p>这个过程之所以能通过, 是因为有如下等式:<br>  cd ≡(me)d ≡med    (mod n)</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://blog.csdn.net/program008/article/details/50563944" target="_blank" rel="noopener">编码和加密算法的使用（MD5、Base64、DES、RSA）</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;对称加密-DES&quot;&gt;&lt;a href=&quot;#对称加密-DES&quot; class=&quot;headerlink&quot; title=&quot;对称加密 - DES&quot;&gt;&lt;/a&gt;对称加密 - DES&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;真正的加密算法，带密钥，加密和解密使用相同的密钥&lt;/li&gt;
&lt;li&gt;对称
      
    
    </summary>
    
    
      <category term="技术" scheme="http://jiaxf.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="加密" scheme="http://jiaxf.github.io/tags/%E5%8A%A0%E5%AF%86/"/>
    
      <category term="解密" scheme="http://jiaxf.github.io/tags/%E8%A7%A3%E5%AF%86/"/>
    
      <category term="算法" scheme="http://jiaxf.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>MD5、SHA1、HMAC、HMAC_SHA1区别</title>
    <link href="http://jiaxf.github.io/2018/05/02/MD5%E3%80%81SHA1%E3%80%81HMAC%E3%80%81HMAC_SHA1/"/>
    <id>http://jiaxf.github.io/2018/05/02/MD5、SHA1、HMAC、HMAC_SHA1/</id>
    <published>2018-05-02T07:43:02.000Z</published>
    <updated>2018-05-03T01:16:37.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MD5、SHA1、HMAC、HMAC-SHA1区别"><a href="#MD5、SHA1、HMAC、HMAC-SHA1区别" class="headerlink" title="MD5、SHA1、HMAC、HMAC_SHA1区别"></a>MD5、SHA1、HMAC、HMAC_SHA1区别</h1><h2 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h2><p>MD5 – message-digest algorithm 5(信息-摘要算法)缩写，是一种不可逆的加密算法，对任何字符串都可以加密成一段唯一的固定长度的代码。可以是128位。<br>MD5码可以唯一地代码原信息的特征，通常用于密码的加密存储，数字签名，文件完整性验证等。</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * MD5加密  </span></span><br><span class="line"><span class="comment"> *   </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception  </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] encryptMD5(<span class="keyword">byte</span> [] data) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">  MessageDigest md5 = MessageDigest.getInstance(KEY_MD5);</span><br><span class="line">  md5.update(data);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">return</span> md5.<span class="title">digest</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="SHA1"><a href="#SHA1" class="headerlink" title="SHA1"></a>SHA1</h2><p>SHA(Secure Hash Algorithm,安全散列算法)，较MD5更安全。<br>SHA1是由NISTNSA设计，对长度小于264的输入，产生长度为160bit的散列值，可穷举性(brute-force<br>  )更好。SHA-1是由美国标准技术局（NIST）颁布的国家标准，是一种应用最为广泛的Hash函数算法，也是<br>  目前最先进的加密技术，被政府部门和私营业主用来处理敏感信息。也常用于验证文件有没有被篡改。</p>  <figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] encryptSHA(<span class="keyword">byte</span>[] data) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">  MessageDigest sha = MessageDigest.getInstance(KEY_SHA);</span><br><span class="line">  sha.update(data);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">return</span> sha.<span class="title">digest</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HMAC-SHA1"><a href="#HMAC-SHA1" class="headerlink" title="HMAC_SHA1"></a>HMAC_SHA1</h2><p>HMAC是密钥相关的哈希运算消息认证码(Hash-based Message Authentication Code, 散列消息鉴别码),HMAC运算利用哈希算法，以一个密钥和一个消息为输入，生产一个消息摘要作为输出。消息鉴别码实现鉴别的原理是，<br>用公开函数和密钥产生一个固定长度的值作为认证标识，用这个标识鉴别消息的完整性。使用一个密钥生成一个<br>固定大小的小数据块，即MAC,并将其加入到消息中，然后传输。接收方利用与发送方共享的密钥进行鉴别认证等。</p><p>HMAC_SHA1需要一个密钥，而SHA1不需要。</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 初始化HMAC密钥  </span></span><br><span class="line"><span class="comment"> *   </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception  </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function">String <span class="title">initMacKey</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  Keygenerator keyGenerator = KeyGenerator.getInstance(KEY_MAC);</span><br><span class="line"></span><br><span class="line">  SecretKey secretKey = keyGenerator.geterateKey();</span><br><span class="line">  <span class="keyword">return</span> encryptBASE64(secretKey.getEncoded());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * HMAC加密  </span></span><br><span class="line"><span class="comment"> *   </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> data  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception  </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] encryptHMAC(<span class="keyword">byte</span>[] data, String key) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">  SecretKey secretKey = <span class="keyword">new</span> SecretKeySpec(decryptBASE64(key), KEY_MAC);</span><br><span class="line">  Mac mac = Mac.getInstance(secretKey.getAlgorithm());</span><br><span class="line">  mac.init(secretKey);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">return</span> mac.<span class="title">doFinal</span><span class="params">(data)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="CRC"><a href="#CRC" class="headerlink" title="CRC"></a>CRC</h2><p>CRC的全称为CyclicRedundancyCheck，中文名称为循环冗余校验。它是一类重要的线性分组码，编码和解码方法<br>简单，检错和纠错能力强，在通信领域广泛地用于实现差错控制。</p><h2 id="BASE64"><a href="#BASE64" class="headerlink" title="BASE64"></a>BASE64</h2><p>按照RFC2045的定义，Base64被定义为：Base64内容传送编码被设计用来把任意序列的8位字节描述为一种<br>不易被人直接识别的形式。（The Base64 Content-Transfer-Encoding is designed to represent<br> brbitrary sequences of octets in a form that need not be humamly readable.）</p> <figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="markdown">/**  </span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">* </span>BASE64解密  </span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">*   </span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">* </span>@param key  </span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">* </span>@return  </span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">* </span>@throws Exception  </span></span></span><br><span class="line"><span class="comment"><span class="markdown">*/</span></span></span><br><span class="line">public <span class="keyword">static</span> byte[] decryptBASE64(<span class="built_in">String</span> key) throws Exception &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">new</span> BASE64Decoder()).decodeBuffer(key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="markdown">/**  </span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">* </span>BASE64加密  </span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">*   </span></span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">* </span>@param key  </span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">* </span>@return  </span></span></span><br><span class="line"><span class="comment"><span class="markdown"><span class="bullet">* </span>@throws Exception  </span></span></span><br><span class="line"><span class="comment"><span class="markdown">*/</span></span>    </span><br><span class="line">public <span class="keyword">static</span> <span class="built_in">String</span> encryptBASE64(byte[] key) throws Exception &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">new</span> BASE64Encoder()).encodeBuffer(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>##　hash算法的作用</p><ul><li><ol><li>文件校验</li></ol></li></ul><p>MD5Hash算法的“数字指纹”，使它成为目前应用最广泛的一种文件完整性校验和（Checksum）算法，不少Unix<br>系统有提供计算md5checksum的命令。</p><ul><li><ol start="2"><li>数字签名</li></ol></li></ul><p>Hash算法也是现代密码体系中的一个重要组成部分，由于非对称算法的运算速度较慢，所以在数字签名协议中，<br>单项散列函数扮演了一个重要的角色。对Hash值，又称”数字摘要”进行数字签名，在统计上可以任务与对文件<br>本身进行数字签名是等效的。</p><ul><li><ol start="3"><li>鉴权协议</li></ol></li></ul><p><em>完整代码</em></p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.security.MessageDigest;    </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;    </span><br><span class="line"><span class="keyword">import</span> javax.crypto.Mac;    </span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;    </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sun.misc.BASE64Decoder;    </span><br><span class="line"><span class="keyword">import</span> sun.misc.BASE64Encoder;    </span><br><span class="line"></span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * 基础加密组件  </span></span><br><span class="line"><span class="comment"> *   </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> jiaxf  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.0  </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0  </span></span><br><span class="line"><span class="comment"> */</span>    </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Coder</span> </span>&#123;    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_SHA = <span class="string">"SHA"</span>;    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_MD5 = <span class="string">"MD5"</span>;    </span><br><span class="line"></span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * MAC算法可选以下多种算法  </span></span><br><span class="line"><span class="comment">     *   </span></span><br><span class="line"><span class="comment">     * &lt;pre&gt;  </span></span><br><span class="line"><span class="comment">     * HmacMD5   </span></span><br><span class="line"><span class="comment">     * HmacSHA1   </span></span><br><span class="line"><span class="comment">     * HmacSHA256   </span></span><br><span class="line"><span class="comment">     * HmacSHA384   </span></span><br><span class="line"><span class="comment">     * HmacSHA512  </span></span><br><span class="line"><span class="comment">     * &lt;/pre&gt;  </span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_MAC = <span class="string">"HmacMD5"</span>;    </span><br><span class="line"></span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * BASE64解密  </span></span><br><span class="line"><span class="comment">     *   </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception  </span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] decryptBASE64(String key) <span class="keyword">throws</span> Exception &#123;    </span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">new</span> BASE64Decoder()).decodeBuffer(key);    </span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * BASE64加密  </span></span><br><span class="line"><span class="comment">     *   </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception  </span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function">String <span class="title">encryptBASE64</span><span class="params">(<span class="keyword">byte</span>[] key)</span> <span class="keyword">throws</span> Exception </span>&#123;    </span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">new</span> BASE64Encoder()).encodeBuffer(key);    </span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * MD5加密  </span></span><br><span class="line"><span class="comment">     *   </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception  </span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] encryptMD5(<span class="keyword">byte</span>[] data) <span class="keyword">throws</span> Exception &#123;    </span><br><span class="line"></span><br><span class="line">        MessageDigest md5 = MessageDigest.getInstance(KEY_MD5);    </span><br><span class="line">        md5.update(data);    </span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">return</span> md5.<span class="title">digest</span><span class="params">()</span></span>;    </span><br><span class="line"></span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * SHA加密  </span></span><br><span class="line"><span class="comment">     *   </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception  </span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] encryptSHA(<span class="keyword">byte</span>[] data) <span class="keyword">throws</span> Exception &#123;    </span><br><span class="line"></span><br><span class="line">        MessageDigest sha = MessageDigest.getInstance(KEY_SHA);    </span><br><span class="line">        sha.update(data);    </span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">return</span> sha.<span class="title">digest</span><span class="params">()</span></span>;    </span><br><span class="line"></span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * 初始化HMAC密钥  </span></span><br><span class="line"><span class="comment">     *   </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception  </span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function">String <span class="title">initMacKey</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;    </span><br><span class="line">        KeyGenerator keyGenerator = KeyGenerator.getInstance(KEY_MAC);    </span><br><span class="line"></span><br><span class="line">        SecretKey secretKey = keyGenerator.generateKey();    </span><br><span class="line">        <span class="keyword">return</span> encryptBASE64(secretKey.getEncoded());    </span><br><span class="line">    &#125;    </span><br><span class="line"></span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment">     * HMAC加密  </span></span><br><span class="line"><span class="comment">     *   </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception  </span></span><br><span class="line"><span class="comment">     */</span>    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] encryptHMAC(<span class="keyword">byte</span>[] data, String key) <span class="keyword">throws</span> Exception &#123;    </span><br><span class="line"></span><br><span class="line">        SecretKey secretKey = <span class="keyword">new</span> SecretKeySpec(decryptBASE64(key), KEY_MAC);    </span><br><span class="line">        Mac mac = Mac.getInstance(secretKey.getAlgorithm());    </span><br><span class="line">        mac.init(secretKey);    </span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">return</span> mac.<span class="title">doFinal</span><span class="params">(data)</span></span>;    </span><br><span class="line"></span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>测试类</em></p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  <span class="keyword">static</span> org.junit.Assert.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**  </span></span><br><span class="line"><span class="comment"> *   </span></span><br><span class="line"><span class="comment"> * @author jiaxf</span></span><br><span class="line"><span class="comment"> * @version 1.0  </span></span><br><span class="line"><span class="comment"> * @since 1.0  </span></span><br><span class="line"><span class="comment"> */</span>    </span><br><span class="line"><span class="keyword">public</span> class CoderTest &#123;    </span><br><span class="line"></span><br><span class="line">    @Test    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> test() <span class="keyword">throws</span> Exception &#123;    </span><br><span class="line">        <span class="keyword">String</span> inputStr = <span class="string">"简单加密"</span>;    </span><br><span class="line">        System.err.<span class="built_in">println</span>(<span class="string">"原文:/n"</span> + inputStr);    </span><br><span class="line"></span><br><span class="line">        <span class="built_in">byte</span>[] inputData = inputStr.getBytes();    </span><br><span class="line">        <span class="keyword">String</span> code = Coder.encryptBASE64(inputData);    </span><br><span class="line"></span><br><span class="line">        System.err.<span class="built_in">println</span>(<span class="string">"BASE64加密后:/n"</span> + code);    </span><br><span class="line"></span><br><span class="line">        <span class="built_in">byte</span>[] output = Coder.decryptBASE64(code);    </span><br><span class="line"></span><br><span class="line">        <span class="keyword">String</span> outputStr = <span class="keyword">new</span> <span class="keyword">String</span>(output);    </span><br><span class="line"></span><br><span class="line">        System.err.<span class="built_in">println</span>(<span class="string">"BASE64解密后:/n"</span> + outputStr);    </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 验证BASE64加密解密一致性    </span></span><br><span class="line">        assertEquals(inputStr, outputStr);    </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 验证MD5对于同一内容加密是否一致    </span></span><br><span class="line">        assertArrayEquals(Coder.encryptMD5(inputData), Coder    </span><br><span class="line">                .encryptMD5(inputData));    </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 验证SHA对于同一内容加密是否一致    </span></span><br><span class="line">        assertArrayEquals(Coder.encryptSHA(inputData), Coder    </span><br><span class="line">                .encryptSHA(inputData));    </span><br><span class="line"></span><br><span class="line">        <span class="keyword">String</span> <span class="built_in">key</span> = Coder.initMacKey();    </span><br><span class="line">        System.err.<span class="built_in">println</span>(<span class="string">"Mac密钥:/n"</span> + <span class="built_in">key</span>);  </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 验证HMAC对于同一内容，同一密钥加密是否一致    </span></span><br><span class="line">        assertArrayEquals(Coder.encryptHMAC(inputData, <span class="built_in">key</span>), Coder.encryptHMAC(    </span><br><span class="line">                inputData, <span class="built_in">key</span>));    </span><br><span class="line"></span><br><span class="line">        BigInteger md5 = <span class="keyword">new</span> BigInteger(Coder.encryptMD5(inputData));    </span><br><span class="line">        System.err.<span class="built_in">println</span>(<span class="string">"MD5:/n"</span> + md5.toString(<span class="number">16</span>));    </span><br><span class="line"></span><br><span class="line">        BigInteger sha = <span class="keyword">new</span> BigInteger(Coder.encryptSHA(inputData));    </span><br><span class="line">        System.err.<span class="built_in">println</span>(<span class="string">"SHA:/n"</span> + sha.toString(<span class="number">32</span>));    </span><br><span class="line"></span><br><span class="line">        BigInteger mac = <span class="keyword">new</span> BigInteger(Coder.encryptHMAC(inputData, inputStr));    </span><br><span class="line">        System.err.<span class="built_in">println</span>(<span class="string">"HMAC:/n"</span> + mac.toString(<span class="number">16</span>));    </span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol><li><a href="https://blog.csdn.net/lplj717/article/details/51828692" target="_blank" rel="noopener">加密算法中BASE64、MD5、SHA、HMAC等之间的区别</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;MD5、SHA1、HMAC、HMAC-SHA1区别&quot;&gt;&lt;a href=&quot;#MD5、SHA1、HMAC、HMAC-SHA1区别&quot; class=&quot;headerlink&quot; title=&quot;MD5、SHA1、HMAC、HMAC_SHA1区别&quot;&gt;&lt;/a&gt;MD5、SHA1、HM
      
    
    </summary>
    
    
      <category term="技术" scheme="http://jiaxf.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="加密" scheme="http://jiaxf.github.io/tags/%E5%8A%A0%E5%AF%86/"/>
    
      <category term="解密" scheme="http://jiaxf.github.io/tags/%E8%A7%A3%E5%AF%86/"/>
    
      <category term="Base64" scheme="http://jiaxf.github.io/tags/Base64/"/>
    
      <category term="md5" scheme="http://jiaxf.github.io/tags/md5/"/>
    
      <category term="算法" scheme="http://jiaxf.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>2018-05-02-Node.js10和npm6发布</title>
    <link href="http://jiaxf.github.io/2018/05/02/2018-05-02-Node.js10%E5%92%8Cnpm6%E5%8F%91%E5%B8%83/"/>
    <id>http://jiaxf.github.io/2018/05/02/2018-05-02-Node.js10和npm6发布/</id>
    <published>2018-05-02T00:54:19.000Z</published>
    <updated>2018-05-02T02:05:44.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Node-js10及npm6发布"><a href="#Node-js10及npm6发布" class="headerlink" title="Node.js10及npm6发布"></a>Node.js10及npm6发布</h1><p>Node.js 发布最新版本 Node.js 10.0.0，同时，npm 6 也随之发布。据了解，今年 10 月，Node.js 10.x 将成为长期支持版本，该版本专注于稳定性、扩展支持以及为各类应用提供一个可靠稳定的平台。</p><p>Node.js 10.x 将是第一个支持 OpenSSL 1.1.0 的版本。该版本配备了 Google V8 6.6 JavaScript 引擎，性能会增强，错误处理和跟踪诊断能力也将会提升。<br>此版本还将推出 Node.js API（N-API），N-API 是一个稳定的 API 模块，它独立于 V8，这样就不会阻碍模块在不重新编译的情况下运行新版本的 Node.js。</p><h2 id="关于-N-API"><a href="#关于-N-API" class="headerlink" title="关于 N-API"></a>关于 N-API</h2><p>N-API 提高了 Node.js 的 ABI 稳定性，有助于模块的部署和维护。<br>Node.js 10 将 ABI 的稳定模块 API（N-API）作为官方支持的 API 层。N-API 旨在解决当今生态系统中的两个问题，一是降低本地模块的维护成本，二是在升级 Node.js 版本时，降低模块使用者之间的摩擦。</p><p>升级到最新的 Node.js 版本后，Node.js 版本之间的模块损坏将不再成为 N-API 模块的问题，这对于开发者和消费者来说都是双赢的。为了提高此功能的实用性，N-API 也将被移植到 Node.js 8.x 和 6.x 中，还包括下一版本。</p><h2 id="现代化的加密"><a href="#现代化的加密" class="headerlink" title="现代化的加密"></a>现代化的加密</h2><p>Node.js 10.x 是第一代支持 OpenSSL 1.1.0 的版本，Node.js 现在能够充分利用由 OpenSSL 团队在代码质量、清理和现代化上提供的服务。</p><p>Node.js 现在可以将其加密支持扩展到对称加密算法 ChaCha20 和身份认证算法 Poly1305 上，它们共同构成了现代加密系统，增加了 Node.js 使用“ AEAD ”密码套件的可能性。<br>伴随着最近 TLS 1.3 规范的完成，网络安全迈出了一大步，OpenSSL 团队正准备发布 1.1.1 版本，其主要特性是支持 TLS 1.3，而支持 OpenSSL 1.1.1 的 Node.js 10 将可以轻松实现 API 和 ABI 的稳定升级。</p><h2 id="错误处理能力提升"><a href="#错误处理能力提升" class="headerlink" title="错误处理能力提升"></a>错误处理能力提升</h2><p>Node.js 10.x 在利用错误代码以缓解持续性的错误检验上取得了很好的进展。过去，更改文本里的错误都需要等到 semver 主版本更新后，这也意味着只有等到下一个主版本的 Node.js 才能对错误进行更改，而 Node.js 主版本每六个月发布一次。使用错误代码将可以在不中断应用程序的情况下更新文本。</p><h2 id="性能改进"><a href="#性能改进" class="headerlink" title="性能改进"></a>性能改进</h2><p>最新的 V8 在 Promise、异步生成器和阵列性能（array performance）有了很大的改进，Promise 和异步函数的改进消除了异步函数和 desugarded promise 链之间的隔阂，这有利于提高使用 Node.js 构建的应用程序性能。</p><h2 id="诊断跟踪和Post-mortem"><a href="#诊断跟踪和Post-mortem" class="headerlink" title="诊断跟踪和Post mortem"></a>诊断跟踪和Post mortem</h2><p>在 Node.js 10 中，新的跟踪事件由 performance API 发布，提高了代码的透明性。此外，它还将引入了新的 API，允许用户在代码运行时按需启用和禁用跟踪事件，从而提高了运行时诊断 Node.js 应用程序问题的灵活性。</p><h2 id="Node-js-10-x引入npm6"><a href="#Node-js-10-x引入npm6" class="headerlink" title="Node.js 10.x引入npm6"></a>Node.js 10.x引入npm6</h2><p>Node.js 10.0.0 附带 npm 5.7.x， 但是，预计在 Node.js 10.x 生命周期的早期会更新为 npm 6。第 6 版将侧重于性能、稳定性和安全性，与先前版本的 npm 相比，性能提高 1700％。<br>以后，如果使用具有已知安全问题的代码，npm Registry 的用户会收到警告通知。npm 将自动检查针对 NSP 数据库的安装请求，并在代码包含漏洞时发出警告通知。</p><p>有关npm6的更多信息，可访问<a href="https://go.npm.me/npm6" target="_blank" rel="noopener">https://go.npm.me/npm6</a></p><blockquote><p>注意： Node.js 10 版本可能还会发生其他变动，可参考<a href="https://medium.com/the-node-js-collection/the-node-js-project-introduces-latest-release-line-node-js-10-x-bf07abfa9076" target="_blank" rel="noopener">https://medium.com/the-node-js-collection/the-node-js-project-introduces-latest-release-line-node-js-10-x-bf07abfa9076</a></p></blockquote><h3 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h3><ol><li><a href="https://nodejs.org/en/blog/release/v10.0.0/" target="_blank" rel="noopener">Node.js 10文档</a></li><li><a href="http://nodejs.cn/api/" target="_blank" rel="noopener">Node.js API 中文文档</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Node-js10及npm6发布&quot;&gt;&lt;a href=&quot;#Node-js10及npm6发布&quot; class=&quot;headerlink&quot; title=&quot;Node.js10及npm6发布&quot;&gt;&lt;/a&gt;Node.js10及npm6发布&lt;/h1&gt;&lt;p&gt;Node.js 发布最新版本
      
    
    </summary>
    
    
      <category term="技术" scheme="http://jiaxf.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="node" scheme="http://jiaxf.github.io/tags/node/"/>
    
      <category term="npm" scheme="http://jiaxf.github.io/tags/npm/"/>
    
  </entry>
  
  <entry>
    <title>PWA简介</title>
    <link href="http://jiaxf.github.io/2018/04/25/PWA%E7%AE%80%E4%BB%8B/"/>
    <id>http://jiaxf.github.io/2018/04/25/PWA简介/</id>
    <published>2018-04-25T01:06:57.000Z</published>
    <updated>2018-04-25T03:33:07.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PWA简介"><a href="#PWA简介" class="headerlink" title="PWA简介"></a>PWA简介</h1><p>Progressive Web Apps，简称PWA.<br>渐进式提升Web App原生体验的技术方案，能给用户原生应用的体验。</p><p>PWA能做到原生应用的体验不是靠特指某一项技术，而是经过应用一些新技术进行改进，在安全、性能和体验三个方面都有很大提升，PWA本质上是WebApp，借助一些新技术也具备NativeApp的一些特性，兼具WebApp和NativeApp的优点。</p><h2 id="PWA具有的一些特点及特性"><a href="#PWA具有的一些特点及特性" class="headerlink" title="PWA具有的一些特点及特性"></a>PWA具有的一些特点及特性</h2><p>PWA特点：</p><ul><li>可靠 即使在不稳定的网络环境下，也能瞬间加载并展现</li><li>体验 快速响应，并且有平滑的动画响应用户的操作</li><li>粘性 像设备上的原生应用，具有沉浸式饿得用户体验，用户可以添加到桌面</li></ul><p>PWA具有特性</p><ul><li>渐进式 - Progressive 适用于所有浏览器，因为它以渐进式增强作为宗旨开发</li><li>连接无关性 - 能够借助Service Worker在离线或这网络较差情况下正常访问</li><li>类似应用 - 由于在App Shell模型基础上开发，因为应具有NativeApp的交互和导航，给用户NativeApp的体验</li><li>持续更新 - 始终是最新的，无版本和更新问题</li><li>安全 - 通过HTTPS协议提供服务，防止窥探和确保内容不被篡改</li><li>可索引 - 应用清单文件和ServiceWorker可以让搜索引擎引到，从而将其识别为应用</li><li>粘性 - 通过推送离线通知等，可以让用户回流</li><li>免安装 - 用户可以添加常用的webapp到桌面，免去应用商店下载的麻烦</li><li><p>可链接 - 通过链接即可分享内容，无需下载安装</p></li><li><p>Web App Manifest(主屏图标)</p></li><li>ServiceWorker(离线可用)</li><li>Notification API &amp; Push API(离线通知)</li><li>App Shell &amp; App Skeleton设计模型</li><li>PRPL Pattern(Push, Render, Pre-cache, Lazy-load)</li><li>安全HTTPS</li><li>交互 &amp; 动画</li><li>PWA通常是SPA 通常采用AppShell设计模型</li></ul><h2 id="ServiceWorker"><a href="#ServiceWorker" class="headerlink" title="ServiceWorker"></a>ServiceWorker</h2><h2 id="什么是Service-Worker"><a href="#什么是Service-Worker" class="headerlink" title="什么是Service Worker"></a>什么是Service Worker</h2><p>W3C 组织早在 2014 年 5 月就提出过 Service Worker 这样的一个 HTML5 API ，主要用来做持久的离线缓存。<br>浏览器中的 javaScript 都是运行在一个单一主线程上的，在同一时间内只能做一件事情。随着 Web 业务不断复杂，我们逐渐在 js 中加了很多耗资源、耗时间的复杂运算过程，这些过程导致的性能问题在 WebApp 的复杂化过程中更加凸显出来。</p><p>W3C 组织早早的洞察到了这些问题可能会造成的影响，这个时候有个叫 Web Worker 的 API 被造出来了，这个 API 的唯一目的就是解放主线程，Web Worker 是脱离在主线程之外的，将一些复杂的耗时的活交给它干，完成后通过 postMessage 方法告诉主线程，而主线程通过 onMessage 方法得到 Web Worker 的结果反馈。</p><p>Service Worker 在 Web Worker 的基础上加上了持久离线缓存能力。<br>Service Worker 有以下功能和特性：</p><ul><li>一个独立的 worker 线程，独立于当前网页进程，有自己独立的 worker context。</li><li>一旦被 install，就永远存在，除非被 uninstall</li><li>需要的时候可以直接唤醒，不需要的时候自动睡眠（有效利用资源，此处有坑）</li><li>可编程拦截代理请求和返回，缓存文件，缓存的文件可以被网页进程取到（包括网络离线状态）</li><li>离线内容开发者可控</li><li>能向客户端推送消息</li><li>不能直接操作 DOM</li><li>出于安全的考虑，必须在 HTTPS 环境下才能工作</li><li>异步实现，内部大都是通过 Promise 实现</li></ul><h2 id="Service-Worker生命周期"><a href="#Service-Worker生命周期" class="headerlink" title="Service Worker生命周期"></a>Service Worker生命周期</h2><p>MDN 给出了详细的 Service Worker 生命周期图：<br><img src="/images/sw-lifecycle.png" alt=""></p><p>生命周期状态：</p><ul><li><p>安装( installing )：这个状态发生在 Service Worker 注册之后，表示开始安装，触发 install 事件回调指定一些静态资源进行离线缓存。</p><blockquote><p>install 事件回调中有两个方法：</p><ul><li>event.waitUntil()：传入一个 Promise 为参数，等到该 Promise 为 resolve 状态为止。</li><li>self.skipWaiting()：self 是当前 context 的 global 变量，执行该方法表示强制当前处在 waiting 状态的 Service Worker 进入 activate 状态。</li><li>安装后( installed )：Service Worker 已经完成了安装，并且等待其他的 Service Worker 线程被关闭。</li><li>激活( activating )：在这个状态下没有被其他的 Service Worker 控制的客户端，允许当前的 worker 完成安装，并且清除了其他的 worker 以及关联缓存的旧缓存资源，等待新的 Service Worker 线程被激活。<br>activate 回调中有两个方法：</li><li>event.waitUntil()：传入一个 Promise 为参数，等到该 Promise 为 resolve 状态为止。</li><li>self.clients.claim()：在 activate 事件回调中执行该方法表示取得页面的控制权, 这样之后打开页面都会使用版本更新的缓存。旧的 Service Worker 脚本不再控制着页面，之后会被停止。</li><li>激活后( activated )：在这个状态会处理 activate 事件回调 (提供了更新缓存策略的机会)。并可以处理功能性的事件 fetch (请求)、sync (后台同步)、push (推送)。</li><li>废弃状态 ( redundant )：这个状态表示一个 Service Worker 的生命周期结束。</li></ul></blockquote><blockquote><p>进入废弃 (redundant) 状态的原因可能为这几种：</p><ul><li>安装 (install) 失败</li><li>激活 (activating) 失败</li><li>新版本的 Service Worker 替换了它并成为激活状态</li></ul></blockquote></li></ul><h2 id="Service-Worker支持的事件"><a href="#Service-Worker支持的事件" class="headerlink" title="Service Worker支持的事件"></a>Service Worker支持的事件</h2><p>MDN 也列出了 Service Worker 所有支持的事件：<br><img src="/images/sw-events.png" alt=""></p><h2 id="怎么使用Service-worker"><a href="#怎么使用Service-worker" class="headerlink" title="怎么使用Service worker"></a>怎么使用Service worker</h2><ol><li>注册</li></ol><p>安装serviceWoker ,通常需要在js主线程（常规页面的js）注册SeriveWorker来启动安装，这个过程将会通知浏览器我们的Service Worker线程的javascript文件在什么地方呆着。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">'serviceWorker'</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      navigator.serviceWorker.register(<span class="string">'/sw.js'</span>, &#123;<span class="attr">scope</span>: <span class="string">'/'</span>&#125;)</span><br><span class="line">      .then(<span class="function"><span class="keyword">function</span> (<span class="params">registration</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 注册成功</span></span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'ServiceWoker registration successful with scope:'</span>, registration.scope);</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// 注册失败</span></span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'ServiceWoker registration failed:'</span>, err);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>注：查看是否注册成功，可以用chrome浏览器，输入 <code>chrome://inspect/#service-workers</code></em></p><ol start="2"><li>安装</li></ol><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听 service worker的install事件</span></span><br><span class="line"><span class="keyword">this</span>.addEventListener(<span class="string">'install'</span>, <span class="function"><span class="keyword">function</span><span class="params">(event)</span></span>&#123;</span><br><span class="line">  <span class="comment">// 如果监听到了service worker 已经安装成功，就会调用event.waitUntil回调函数</span></span><br><span class="line">  event.waitUntil(</span><br><span class="line">      <span class="comment">// 安装成功后操作 CacheStorage缓存，使用之前需要先通过caches.open()打开对应缓存空间</span></span><br><span class="line">      cache.open(<span class="string">'my-test-cache-v1'</span>).then(<span class="function"><span class="keyword">function</span><span class="params">(cache)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 通过cache缓存对象的addAll方法添加precache缓存</span></span><br><span class="line">        <span class="keyword">return</span> cache.addAll([</span><br><span class="line">          <span class="string">'/'</span>,</span><br><span class="line">          <span class="string">'/index.html'</span>,</span><br><span class="line">          <span class="string">'/main.css'</span>,</span><br><span class="line">          <span class="string">'/main.js'</span>,</span><br><span class="line">          <span class="string">'/image.jpg'</span></span><br><span class="line">        ])</span><br><span class="line">      &#125;);</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="3"><li>自定义请求响应</li></ol><p>任何被Service Worker控制的资源被请求时，都会触发fetch事件，这些资源包括了指定的scope内的html文档，和这些html文档内引用的其他任何资源。<br>实现思路: Serivice Worker代理服务，给Service Woker添加一个fetch的事件监听器，接着调用event上的<code>respondWith()</code>方法来劫持HTTP响应，然后来更新他们。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">this.addEventListener(<span class="string">'fetch'</span>, <span class="function"><span class="keyword">function</span><span class="params">(event)</span> </span>&#123;</span><br><span class="line">   event.respondWith(</span><br><span class="line">      caches.match(event.request).then(<span class="function"><span class="keyword">function</span><span class="params">(response)</span> </span>&#123;</span><br><span class="line">          <span class="comment">// 来来来，代理可以搞一些代理的事情</span></span><br><span class="line"></span><br><span class="line">          <span class="comment">// 如果Service Worker有自己的返回，就直接返回，减少一次http请求</span></span><br><span class="line">          <span class="keyword">if</span>(response)&#123;</span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 如果service worker没有返回，那就得直接请求真实远程服务</span></span><br><span class="line">          <span class="keyword">var</span> request = event.request.<span class="keyword">clone</span>(); <span class="comment">//把原始请求拷过来</span></span><br><span class="line">          <span class="keyword">return</span> fetch(request).then(<span class="function"><span class="keyword">function</span><span class="params">(httpRes)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// http请求的返回已被抓到，可以处置</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 请求失败了，直接返回失败的结果就好</span></span><br><span class="line">            <span class="keyword">if</span>(!httpRes ||  httpRes.status !== <span class="number">200</span>)&#123;</span><br><span class="line">              <span class="keyword">return</span> httpRes;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 请求成功的话，将请求缓存起来</span></span><br><span class="line">            <span class="keyword">var</span> responseClone = httpRes.<span class="keyword">clone</span>();</span><br><span class="line">            cache.open(<span class="string">'my-test-cache-v1'</span>).then(<span class="function"><span class="keyword">function</span> <span class="params">(cache)</span></span>&#123;</span><br><span class="line">              cache.put(event.request, responseClone);</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> httpRes;</span><br><span class="line">          &#125;);</span><br><span class="line"></span><br><span class="line">      &#125;)</span><br><span class="line">   );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ol start="4"><li><p>Service Worker版本更新</p><ul><li><p>自动更新所有页面</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 安装阶段跳过等待，直接进入active</span></span><br><span class="line"><span class="keyword">self</span>.addEventListener(<span class="string">'install'</span>, <span class="function"><span class="keyword">function</span><span class="params">(event)</span> </span>&#123;</span><br><span class="line">  event.waitUntil(<span class="keyword">self</span>.skipWaiting());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">self</span>.addEventListener(<span class="string">'activate'</span>, <span class="function"><span class="keyword">function</span><span class="params">(event)</span> </span>&#123;</span><br><span class="line">  event.waitUntil(</span><br><span class="line">      Promise.all([</span><br><span class="line">        <span class="comment">// 更新客户端</span></span><br><span class="line">        <span class="keyword">self</span>.clients.claim(),</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 清理旧版本</span></span><br><span class="line">        caches.keys().then(<span class="function"><span class="keyword">function</span><span class="params">(cacheList)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Promise.all(</span><br><span class="line">                cacheList.map(<span class="function"><span class="keyword">function</span><span class="params">(cacheName)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span>(cacheName ！== <span class="string">'my-test-cache-v1'</span>)&#123;</span><br><span class="line">                      <span class="keyword">return</span> caches.delete(cacheName)；</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            );</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">      ])</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>手动更新Service Worker</p></li></ul></li></ol><p>在页面中可以手动借助<code>Registration.update()</code>更新。</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var version = <span class="string">'1.0.1'</span>;</span><br><span class="line">navigator.serviceWorker.register(<span class="string">'/sw.js'</span>).<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span><span class="params">(reg)</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(localStorage.getItem(<span class="string">'sw_version'</span>) !== version)&#123;</span><br><span class="line">    reg.update().<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span><span class="params">()</span></span> &#123;</span><br><span class="line">      localStorage.setItem(<span class="string">'sw_version'</span>, version)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li><p>debug时更新</p><p>Service Worker被载入后立即激活可以保证每次<code>/sw.js</code>为最新。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span>.addEventListener(<span class="string">'install'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">self</span>.skipWaiting();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>意外惊喜</p></li></ul><p>Service Worker的特殊之处除了由浏览器触发更新之外，还应用了特殊的缓存策略：如果该文件已24小时没有更新，当update触发时会强制更新。意外着最坏情况下Service Worker会每天更新一次。</p><p>ServiceWorker如何更新？</p><ul><li>浏览器每天至少更新一次ServiceWorker</li><li>注册新的Service Worker,带上版本号，如: /sw.js?t=201709091920</li><li>手动更新resistration.update()</li><li>逐字节对比新的sw文件和旧的sw，有区别才更新</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.html</span></span><br><span class="line">navigator.serviceWoker.addEventListener(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(e.data === <span class="string">'sw.update'</span>)&#123;</span><br><span class="line">    <span class="comment">//提醒用户刷新</span></span><br><span class="line">  &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// sw.js</span></span><br><span class="line"><span class="keyword">self</span>.clients.matchAll().then(<span class="function"><span class="keyword">function</span><span class="params">(clients)</span></span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(clients &amp;&amp; clients.length)&#123;</span><br><span class="line">    clients.<span class="keyword">forEach</span>(<span class="function"><span class="keyword">function</span><span class="params">(client)</span></span>&#123;</span><br><span class="line">      client.postMessage(<span class="string">'sw.update'</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><p>PWA SEO可以服务器端渲染Server Side Rendering(SSR).<br>SSR中如何正确使用Service Worker</p><p><img src="/images/ssr.jpg" alt=""></p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol><li><a href="https://lavas.baidu.com/" target="_blank" rel="noopener">LAVAS百度</a></li><li><a href="/works/PWA.pdf">个人分享PWA简介</a></li><li><a href="https://static001.geekbang.org/con/28/pdf/2706484488/file/QCon2018-%E3%80%8ALavas%EF%BC%9APWA%E7%9A%84%E6%8E%A2%E7%B4%A2%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E3%80%8B-%E5%BD%AD%E6%98%9F.pdf" target="_blank" rel="noopener">QCon2018-《Lavas：PWA的探索与最佳实践》-彭星</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;PWA简介&quot;&gt;&lt;a href=&quot;#PWA简介&quot; class=&quot;headerlink&quot; title=&quot;PWA简介&quot;&gt;&lt;/a&gt;PWA简介&lt;/h1&gt;&lt;p&gt;Progressive Web Apps，简称PWA.&lt;br&gt;渐进式提升Web App原生体验的技术方案，能给用户原
      
    
    </summary>
    
    
      <category term="javascript" scheme="http://jiaxf.github.io/tags/javascript/"/>
    
      <category term="技术" scheme="http://jiaxf.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
  </entry>
  
  <entry>
    <title>区块链的几个基本概念</title>
    <link href="http://jiaxf.github.io/2018/04/20/%E5%8C%BA%E5%9D%97%E9%93%BE%E7%9A%84%E5%87%A0%E4%B8%AA%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/"/>
    <id>http://jiaxf.github.io/2018/04/20/区块链的几个基本概念/</id>
    <published>2018-04-20T06:36:45.000Z</published>
    <updated>2018-04-25T03:33:07.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="区块链的几个基本概念"><a href="#区块链的几个基本概念" class="headerlink" title="区块链的几个基本概念"></a>区块链的几个基本概念</h1><p><code>区块链</code>（blockchain）本质上是一种特殊的分布式数据库。</p><p><img src="/img/bg2017122701.jpg" alt=""></p><p>首先，区块链的主要作用是储存信息。任何需要保存的信息，都可以写入区块链，也可以从里面读取，所以它是数据库。</p><p>其次，任何人都可以架设服务器，加入区块链网络，成为一个节点。区块链的世界里面，没有中心节点，每个节点都是平等的，都保存着整个数据库。你可以向任何一个节点，写入/读取数据，因为所有节点最后都会同步，保证区块链一致。</p><p>区块链是去中心化的，没有管理员，是彻底无中心的。</p><h2 id="区块"><a href="#区块" class="headerlink" title="区块"></a>区块</h2><p>区块链是由一个个<code>区块</code>（block）组成。区块很像数据库的记录，每次写入数据，就是创建一个区块。</p><p>每个区块包含两个部分</p><ul><li>区块头(Head): 记录当前区块的特征值（当前时间、上一个区块的Hash、区块体的Hash）</li><li>区块体（body): 实际数据</li></ul><blockquote><p>两个重要推论：</p><p>推论1: 每个区块的哈希都是不一样的，可以通过哈希标识区块。</p><p>推论2：如果区块的内容变了，它的哈希一定会改变。</p></blockquote><h2 id="采矿"><a href="#采矿" class="headerlink" title="采矿"></a>采矿</h2><p>添加新区块需要一定的计算，只有通过极其大量的计算，才能得到当前区块的有效哈希，从而把新区块添加到区块链。<br>这个过程就叫做采矿（mining),因为计算有效哈希的难度，好比在全世界的沙子里面，找到一粒符合条件的沙子。<br>计算哈希的机器就叫做矿机，操作矿机的人就叫做矿工。</p><h2 id="难度系数"><a href="#难度系数" class="headerlink" title="难度系数"></a>难度系数</h2><p>区块头包含一个难度（difficulty),这个值决定了计算哈希的难度。<br>区块链协议规定，使用一个常量除以难度系数，可以得到目标值（target）。难度系数越大，目标值就越小。</p><h3 id="区块链的适用场景"><a href="#区块链的适用场景" class="headerlink" title="区块链的适用场景"></a>区块链的适用场景</h3><ol><li>不存在所有成员都信任的管理当局</li><li>希尔的数据不要求实时使用</li><li>挖矿的收益能弥补本身成本</li></ol><h2 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h2><p>加密和解密需要两把钥匙：一把公钥和一把私钥。公钥是公开的，任何人都可以获取。私钥是保密的，只有拥有者才能使用。<br>他人使用你的公钥加密信息，然后发送给你，你用私钥解密，取出信息。反过来，你也可以用私钥加密信息，别人用你的公钥<br>解开，从而证明这个信息是你发的，且未被篡改，这就叫数字签名。</p><h3 id="比特币特点"><a href="#比特币特点" class="headerlink" title="比特币特点"></a>比特币特点</h3><ol><li>不会轻易被偷走</li><li>无法伪造</li><li>无法大批生成</li></ol><h3 id="区块链的作用"><a href="#区块链的作用" class="headerlink" title="区块链的作用"></a>区块链的作用</h3><p>区块链就是一个数据库，记载了所有的交易，用作中央记账系统，分布在无数个节点之上。</p><blockquote><p>数字货币的本质就是一条可信的数据库记录。</p></blockquote><p>比特币协议规定，分支点之后最先达到6个区块的那个分支被认定为正式的区块链，其他分支都被放弃。由于区块<br>的生成速度由计算能力决定，所以到底哪一笔交易最后会被写入区块链，完全由它所在的分支能吸引多少计算能力决定。<br>隐藏的逻辑是，如果大多数人（计算能力）选择相信某一笔交易，那么它就应该是真的。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;区块链的几个基本概念&quot;&gt;&lt;a href=&quot;#区块链的几个基本概念&quot; class=&quot;headerlink&quot; title=&quot;区块链的几个基本概念&quot;&gt;&lt;/a&gt;区块链的几个基本概念&lt;/h1&gt;&lt;p&gt;&lt;code&gt;区块链&lt;/code&gt;（blockchain）本质上是一种特殊的分
      
    
    </summary>
    
    
      <category term="技术" scheme="http://jiaxf.github.io/tags/%E6%8A%80%E6%9C%AF/"/>
    
      <category term="区块链" scheme="http://jiaxf.github.io/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
  </entry>
  
  <entry>
    <title>函数式编程</title>
    <link href="http://jiaxf.github.io/2018/04/19/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/"/>
    <id>http://jiaxf.github.io/2018/04/19/函数式编程/</id>
    <published>2018-04-19T06:19:50.000Z</published>
    <updated>2018-04-19T06:44:50.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h1><h2 id="Javascript的箭头函数"><a href="#Javascript的箭头函数" class="headerlink" title="Javascript的箭头函数"></a>Javascript的箭头函数</h2><p><code>ECMAScript2015</code>引入箭头表达式。箭头函数其实是匿名函数，基本语法如下：</p><blockquote><p>(param1, param2, …, paramN) =&gt; { statements }</p><p>(param1, param2, …, paramN) =&gt; expression</p><p>   // 等于 :  =&gt; { return expression; }</p><p>   // 只有一个参数时,括号才可以不加:</p><p>   (singleParam) =&gt; { statements }</p><p>   singleParam =&gt; { statements }</p><p>   //如果没有参数,就一定要加括号:</p><p>   () =&gt; { statements }</p></blockquote><p>示例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> simple = <span class="function"><span class="params">a</span> =&gt;</span> a &gt; <span class="number">15</span> ? <span class="number">15</span> : a;</span><br><span class="line">simple(<span class="number">16</span>);   <span class="comment">// 15</span></span><br><span class="line">simple(<span class="number">10</span>);   <span class="comment">// 10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> max = <span class="function">(<span class="params">a, b</span>) =&gt;</span> a &gt; b ? a : b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">5</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">18</span>, <span class="number">23</span>];</span><br><span class="line"><span class="keyword">var</span> sum = arr.reduce(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b);  <span class="comment">//66</span></span><br><span class="line"><span class="keyword">var</span> even = arr.filter(<span class="function"><span class="params">v</span> =&gt;</span> v % <span class="number">2</span> == <span class="number">0</span>); <span class="comment">// [6, 0, 18]</span></span><br><span class="line"><span class="keyword">var</span> double = arr.map(<span class="function"><span class="params">v</span> =&gt;</span> v * <span class="number">2</span>);       <span class="comment">// [10, 12, 26, 0, 36, 46]</span></span><br></pre></td></tr></table></figure><p>有些时候，某些函数在声明的时候就是调用的时候，尤其是函数式编程中，一个函数还对外返回函数的时候。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MakePowerFn</span>(<span class="params">power</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">PowerFn</span>(<span class="params">base</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.pow(base, power);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">power3 = MakePowerFn(<span class="number">3</span>); <span class="comment">// 制造一个X的3次方的函数</span></span><br><span class="line">power2 = MakePowerFn(<span class="number">2</span>); <span class="comment">// 制造一个X的2次方的函数</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(power3(<span class="number">10</span>));  <span class="comment">// 10的3次方 1000</span></span><br><span class="line"><span class="built_in">console</span>.log(power2(<span class="number">10</span>));  <span class="comment">// 10的2次方 100</span></span><br></pre></td></tr></table></figure><p>用箭头函数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">MakePowerFn = <span class="function"><span class="params">power</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">base</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.pow(base, power);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简化</span></span><br><span class="line">MakePowerFn = <span class="function"><span class="params">power</span> =&gt;</span> base =&gt; <span class="built_in">Math</span>.pow(base, power)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加上括号</span></span><br><span class="line">MakePowerFn = <span class="function">(<span class="params">power</span>) =&gt;</span> (</span><br><span class="line">  (base) =&gt; (<span class="built_in">Math</span>.pow(base, power))</span><br><span class="line">  )</span><br></pre></td></tr></table></figure><h2 id="匿名函数的递归"><a href="#匿名函数的递归" class="headerlink" title="匿名函数的递归"></a>匿名函数的递归</h2><p>函数式编程立志于用函数表达式来消除有状态的函数，以及for/while循环，所以在函数式编程里不应该用for/while循环，而要改用递归(递归的性能很差，所以，一般用尾递归来做优化，也就是把函数的计算状态当参数一层一层往下传递，这样语言的编译器后解释器就需要用函数栈来帮你保存函数的内部变量的状态了)。</p><p>递归的代码就是函数自己调用自己，比如求阶乘</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title">fact</span>(n)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="type">n</span> == <span class="number">0</span> ? <span class="number">1</span> : <span class="type">n</span> * fact(n-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于匿名函数，可以把匿名函数当成一个参数传给另外一个函数，因为函数的参数有名字，所以就可以调用自己了。</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function combinator(<span class="function"><span class="keyword">func</span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">func</span>)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 箭头函数式的匿名函数</span></span><br><span class="line">（<span class="function"><span class="keyword">func</span>） =&gt; <span class="params">(<span class="keyword">func</span><span class="params">(<span class="keyword">func</span>)</span></span></span>)</span><br></pre></td></tr></table></figure><p>阶乘代码重构<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">funtion fact(<span class="function"><span class="keyword">func</span>, <span class="title">n</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> n == <span class="number">0</span> ? <span class="number">1</span>: n * <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">func</span>, n-<span class="number">1</span>)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 匿名函数版</span></span><br><span class="line"><span class="keyword">var</span> fact = (<span class="function"><span class="keyword">func</span>, <span class="title">n</span>) =&gt; <span class="params">(n == <span class="number">0</span> ? <span class="number">1</span> : <span class="keyword">func</span><span class="params">(<span class="keyword">func</span>, n-<span class="number">1</span>)</span></span></span>);</span><br><span class="line">fact(fact, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数体声明时调用自己</span></span><br><span class="line">（<span class="function"><span class="keyword">func</span>, <span class="title">x</span>) =&gt; <span class="title">func</span><span class="params">(<span class="keyword">func</span>, x)</span></span>(</span><br><span class="line">    (<span class="function"><span class="keyword">func</span>, <span class="title">n</span>) =&gt; <span class="params">( n ==<span class="number">0</span> ? <span class="number">1</span> : n * <span class="keyword">func</span><span class="params">(<span class="keyword">func</span>, n-<span class="number">1</span>)</span></span></span>),  <span class="comment">// 第一个调用参数</span></span><br><span class="line">    <span class="number">5</span> <span class="comment">// 第二个调用参数</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><h2 id="动态高级函数的递归"><a href="#动态高级函数的递归" class="headerlink" title="动态高级函数的递归"></a>动态高级函数的递归</h2><p>递归版高阶函数</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">HighOrderFact = function(<span class="function"><span class="keyword">func</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> function(n)&#123;</span><br><span class="line">    <span class="keyword">return</span> n == <span class="number">0</span> ? <span class="number">1</span> : <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">func</span>)</span><span class="params">(n-1)</span>;</span></span><br><span class="line"><span class="function">  &#125;;</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 需要一个函数做参数，然后返回这个函数的递归版本</span></span><br><span class="line"><span class="function"><span class="title">fact</span> = <span class="title">HighOrderFact</span><span class="params">(HighOrderFact)</span>;</span></span><br><span class="line"><span class="function"><span class="title">fact</span><span class="params">(5)</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">HighOrderFact</span><span class="params">(HighOrderFact)</span><span class="params">(5)</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">fact</span> = <span class="title">function</span><span class="params">(hifunc)</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> hifunc(hifunc);</span><br><span class="line">&#125;(</span><br><span class="line">   <span class="comment">// 调用参数是一个函数</span></span><br><span class="line">   function(<span class="function"><span class="keyword">func</span>)</span>&#123;</span><br><span class="line">     <span class="keyword">return</span> function(n)&#123;</span><br><span class="line">       <span class="keyword">return</span> n == <span class="number">0</span> ? <span class="number">1</span> : n * <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">func</span>)</span><span class="params">(n-1)</span>;</span></span><br><span class="line"><span class="function">     &#125;;</span></span><br><span class="line"><span class="function">   &#125;</span></span><br><span class="line"><span class="function">);</span></span><br><span class="line"><span class="function">// 调用</span></span><br><span class="line"><span class="function"><span class="title">fact</span><span class="params">(5)</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 箭头函数重构</span></span><br><span class="line"><span class="function"><span class="title">fact</span> = <span class="params">(highfunc =&gt; highfunc(highfunc)</span>) <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  <span class="keyword">func</span> =&gt; n =&gt; n == 0 ? 1 : n * <span class="keyword">func</span>(<span class="keyword">func</span>)</span><span class="params">(n-1)</span></span></span><br><span class="line"><span class="function">);</span></span><br></pre></td></tr></table></figure><h2 id="重构之前的程序"><a href="#重构之前的程序" class="headerlink" title="重构之前的程序"></a>重构之前的程序</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 查找数组正常版本</span></span><br><span class="line"> function <span class="built_in">find</span>(x, y) &#123;</span><br><span class="line">   <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i&lt; x.length; i++)&#123;</span><br><span class="line">     <span class="keyword">if</span>(x[i] == y) <span class="keyword">return</span> i;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> null;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 干掉for，搞成递归版本</span></span><br><span class="line"> funcion  <span class="built_in">find</span>(x, y, i=<span class="number">0</span>)&#123;</span><br><span class="line">   <span class="keyword">if</span>( i &gt;= x.length) <span class="keyword">return</span> null;</span><br><span class="line">   <span class="keyword">if</span>( x[i] == y) <span class="keyword">return</span> i;</span><br><span class="line">   <span class="keyword">return</span> <span class="built_in">find</span>(x, y, i+<span class="number">1</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 继续重构 带实参的匿名函数版本</span></span><br><span class="line">((<span class="function"><span class="keyword">func</span>, <span class="title">x</span>, <span class="title">y</span>, <span class="title">i</span>) =&gt; <span class="title">func</span><span class="params">(<span class="keyword">func</span>, x,y i)</span></span>) ( <span class="comment">// 函数体</span></span><br><span class="line">    (<span class="function"><span class="keyword">func</span>, <span class="title">x</span>, <span class="title">y</span>, <span class="title">i</span>=0) =&gt; <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      i&gt;= x.length ? null :</span></span></span><br><span class="line"><span class="function"><span class="params">        x[i] == y ? i : <span class="keyword">func</span><span class="params">(<span class="keyword">func</span>, x, y, i+<span class="number">1</span>)</span></span></span></span><br><span class="line">      ), <span class="comment">// 第一个调用参数</span></span><br><span class="line">      arr,  <span class="comment">// 第二个调用参数</span></span><br><span class="line">      <span class="number">2</span> <span class="comment">// 第三个调用参数    </span></span><br><span class="line">)</span><br><span class="line"> <span class="comment">// 引入高级函数，去除实参</span></span><br><span class="line"></span><br><span class="line">const <span class="built_in">find</span> = （highfunc =&gt; highfunc(highfunc))(</span><br><span class="line">   <span class="function"><span class="keyword">func</span> =&gt; <span class="params">(x, y, i =<span class="number">0</span> )</span></span> =&gt; (</span><br><span class="line">      i &gt;= x.length ? null :</span><br><span class="line">        x[i] == y ? i : <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">func</span>)</span></span>(x, y, i+<span class="number">1</span>)</span><br><span class="line">  )</span><br><span class="line">)</span><br><span class="line"> ;</span><br></pre></td></tr></table></figure><p>可以参考以下两篇文章</p><ul><li><em><a href="http://mvanier.livejournal.com/2897.html" target="_blank" rel="noopener">《The Y Combinator (Slight Return)》</a></em></li><li><em><a href="https://en.wikipedia.org/wiki/Fixed-point_combinator" target="_blank" rel="noopener">《Wikipedia: Fixed-point combinator》</a></em></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;函数式编程&quot;&gt;&lt;a href=&quot;#函数式编程&quot; class=&quot;headerlink&quot; title=&quot;函数式编程&quot;&gt;&lt;/a&gt;函数式编程&lt;/h1&gt;&lt;h2 id=&quot;Javascript的箭头函数&quot;&gt;&lt;a href=&quot;#Javascript的箭头函数&quot; class=&quot;he
      
    
    </summary>
    
      <category term="技术" scheme="http://jiaxf.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="functional" scheme="http://jiaxf.github.io/tags/functional/"/>
    
      <category term="javascript" scheme="http://jiaxf.github.io/tags/javascript/"/>
    
      <category term="函数式编程" scheme="http://jiaxf.github.io/tags/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Thinking in Ramda 1</title>
    <link href="http://jiaxf.github.io/2018/04/19/1-Thinking%20in%20Ramda/"/>
    <id>http://jiaxf.github.io/2018/04/19/1-Thinking in Ramda/</id>
    <published>2018-04-19T03:48:54.000Z</published>
    <updated>2018-04-19T03:48:54.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Thinking-in-Ramda-getting-started"><a href="#Thinking-in-Ramda-getting-started" class="headerlink" title="Thinking in Ramda: getting started"></a>Thinking in Ramda: getting started</h1><h2 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h2><p>I’ll be using the Ramda JavaScript library fro this series,though many of the ideas apply to other JavaScript libraries such as  Underscore and Lodash as well as to other languages.</p><p>I’m going to stick to the lighter,less-academic end of functional programing.</p><h2 id="Ramda"><a href="#Ramda" class="headerlink" title="Ramda"></a>Ramda</h2><p>I find Ramda to be a nicely designed library that provides a lot of tools for doing functional programming in JavaScript in a clean, elegant way.<br><a id="more"></a></p><h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><p>Some languages go further and provide support for functions as first-class constructs. By “first-class”, I mean that functions can be used in the same way as other kinds of values.You can:</p><ul><li>refer to them from constants and variables</li><li>pass them as parameters to other Functions</li><li>return them as results from other Functions</li></ul><p>JavaScript is one such language, and we’ll be taking advantage of that.</p><h2 id="Pure-Functions"><a href="#Pure-Functions" class="headerlink" title="Pure Functions"></a>Pure Functions</h2><p>Pure functions are functions that have no side-effects.They don’t assign to any outside variables,they don’t consume input, they don’t produce output,they don’t read from or write to a database,they don’t modify the parameters they’re passed,etc.</p><p>The basic idea is that,if you call a function with the same inputs over and over again,you always get the same result.</p><p>You can certainly do things with impure functions(and you must, if you program is going to do anything interesting), but for the most part you’ll want to keep most of you functions pure.</p><h2 id="Immutability"><a href="#Immutability" class="headerlink" title="Immutability"></a>Immutability</h2><p>What dose that mean? “Immutable” means “unchangeable”.</p><p>When I’m working in an immutable fashion, once I initialize a value or an object I never change it again.That means no changing elements of an array or properties of an object.</p><p>If I need to change something in an array or object,I instead return a new copy of it with the changed value. Later posts will talk about this in great detail.</p><p>Immutability goes hand-in-hand with pure functions.Since pure functions aren’t allowed to have side-effects, they aren’t allowed to change outside data structures.They are forced to work with data in an immutable way.</p><h2 id="FOREACH"><a href="#FOREACH" class="headerlink" title="FOREACH"></a>FOREACH</h2><p>Rather than writing an explicit loop,try using the <code>forEach</code> function instead.That is:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Replace this</span></span><br><span class="line"><span class="keyword">for</span> ( <span class="keyword">const</span> value <span class="keyword">of</span> myArray)&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//With</span></span><br><span class="line">forEach(<span class="function"><span class="params">value</span> =&gt;</span> <span class="built_in">console</span>.log(value), myArray)</span><br></pre></td></tr></table></figure><p><code>forEach</code> takes a function an d an array, and calls the function on each element of the array.</p><h2 id="MAP"><a href="#MAP" class="headerlink" title="MAP"></a>MAP</h2><p>Unlike <code>forEach</code>, map collects the results of applying the function into a new array and returns it.</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">map(x =&gt; x *<span class="number">2</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]) <span class="comment">// =&gt;[2,4,6]</span></span><br><span class="line"></span><br><span class="line">const double = x =&gt; x * <span class="number">2</span></span><br><span class="line">map(double, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]) <span class="comment">// =&gt;[2,4,6]</span></span><br></pre></td></tr></table></figure><h2 id="FILTER-REJECT"><a href="#FILTER-REJECT" class="headerlink" title="FILTER/REJECT"></a>FILTER/REJECT</h2><p>As its name might suggest, <code>filter</code> selects elements from an array based on some function.<code>reject</code> does exactly the same thing, but in reverse. It keeps the elements for which the function returns a false value and excludes the values for which it returns a truthy value.</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const isEven = x =&gt; x%<span class="number">2</span> === <span class="number">0</span></span><br><span class="line">filter(isEven, [<span class="number">1</span>,<span class="number">23</span>,<span class="number">4</span>]) <span class="comment">// ==&gt; [2, 4]</span></span><br><span class="line"></span><br><span class="line">reject(isEven, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]) <span class="comment">// ==&gt; [1,3]</span></span><br></pre></td></tr></table></figure><h2 id="FIND"><a href="#FIND" class="headerlink" title="FIND"></a>FIND</h2><p><code>find</code> applies a function to each element of an array and returns the first element for which the function returns a truthy value.</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find(isEven, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])  <span class="comment">// --&gt; 2</span></span><br></pre></td></tr></table></figure><h2 id="REDUCE"><a href="#REDUCE" class="headerlink" title="REDUCE"></a>REDUCE</h2><p><code>reduce</code> takes a two-argument function, and initial value,and the array to operate on.</p><p>The first argument to the function we pass in is called the “accumulator” and the second argument is the value from the array.The function needs to return a new accumulator value.</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">add</span> = (accum, <span class="keyword">value</span>) =&gt; accum + <span class="keyword">value</span></span><br><span class="line">reduce(<span class="keyword">add</span>, <span class="number">5</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])  <span class="comment">// --&gt; 15</span></span><br></pre></td></tr></table></figure><h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>By starting with these collection-iteration functions, you can get used to the idea of passing functions to other functions. You might have used these in other languages without realizing you were doing some functional programming.</p><hr><p><em>Cited From <a href="http://randycoulman.com/blog/2016/05/24/thinking-in-ramda-getting-started/" target="_blank" rel="noopener">« Thinking in Ramda: Getting Started »</a></em></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Thinking-in-Ramda-getting-started&quot;&gt;&lt;a href=&quot;#Thinking-in-Ramda-getting-started&quot; class=&quot;headerlink&quot; title=&quot;Thinking in Ramda: getting started&quot;&gt;&lt;/a&gt;Thinking in Ramda: getting started&lt;/h1&gt;&lt;h2 id=&quot;Getting-Started&quot;&gt;&lt;a href=&quot;#Getting-Started&quot; class=&quot;headerlink&quot; title=&quot;Getting Started&quot;&gt;&lt;/a&gt;Getting Started&lt;/h2&gt;&lt;p&gt;I’ll be using the Ramda JavaScript library fro this series,though many of the ideas apply to other JavaScript libraries such as  Underscore and Lodash as well as to other languages.&lt;/p&gt;
&lt;p&gt;I’m going to stick to the lighter,less-academic end of functional programing.&lt;/p&gt;
&lt;h2 id=&quot;Ramda&quot;&gt;&lt;a href=&quot;#Ramda&quot; class=&quot;headerlink&quot; title=&quot;Ramda&quot;&gt;&lt;/a&gt;Ramda&lt;/h2&gt;&lt;p&gt;I find Ramda to be a nicely designed library that provides a lot of tools for doing functional programming in JavaScript in a clean, elegant way.&lt;br&gt;
    
    </summary>
    
      <category term="技术" scheme="http://jiaxf.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="functional" scheme="http://jiaxf.github.io/tags/functional/"/>
    
      <category term="javascript" scheme="http://jiaxf.github.io/tags/javascript/"/>
    
      <category term="ramda" scheme="http://jiaxf.github.io/tags/ramda/"/>
    
  </entry>
  
  <entry>
    <title>Thinking in Ramda 2</title>
    <link href="http://jiaxf.github.io/2018/04/19/2-Thinking%20in%20Ramda/"/>
    <id>http://jiaxf.github.io/2018/04/19/2-Thinking in Ramda/</id>
    <published>2018-04-19T03:48:54.000Z</published>
    <updated>2018-04-19T03:48:54.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Thinking-in-Ramda-Combining-funtions"><a href="#Thinking-in-Ramda-Combining-funtions" class="headerlink" title="Thinking in Ramda: Combining funtions"></a>Thinking in Ramda: Combining funtions</h1><h2 id="Simple-Combinations"><a href="#Simple-Combinations" class="headerlink" title="Simple Combinations"></a>Simple Combinations</h2><p>Once you’ve gotten used to the idea of passing functions to other functions, you might start to find situations where you want to combine sereral functions together.</p><p>Ramda provides several functions for doing simple combinations.</p><h2 id="Complement"><a href="#Complement" class="headerlink" title="Complement"></a>Complement</h2><p>Ramda provides a higher-order-function,<code>complement</code>, that takes another function and return a new function that returns <code>true</code> when the original function returns a falsy value, and <code>false</code> when the original function returns a truthy value.<br><a id="more"></a></p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const isEven = x =&gt; x % <span class="number">2</span> === <span class="number">0</span></span><br><span class="line">find(complement(isEven), [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]) <span class="comment">//--&gt; 1</span></span><br></pre></td></tr></table></figure><p>Even better is to give the <code>complement</code>ed function its own name so it can be reused:</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const isEven = x =&gt; x % <span class="number">2</span> ===<span class="number">0</span></span><br><span class="line">const isOdd = complement(isEven)</span><br><span class="line"></span><br><span class="line">find(isOdd, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])    <span class="comment">// --&gt; 1</span></span><br></pre></td></tr></table></figure><p>Note that  <code>complement</code> implements the same idea for functions as the <code>!</code>(not) operator does for values.</p><h2 id="BOTH-EITHER"><a href="#BOTH-EITHER" class="headerlink" title="BOTH/EITHER"></a>BOTH/EITHER</h2><p><code>both</code> takes two other functions and returns a new funtion that returns <code>true</code> if both functions return a truthy value when applied to the arguments and  <code>false</code> otherwise.</p><p><code>either</code> takes two other functions and returns a new function that returns <code>true</code> if either function returns a truthy value when applied to the arguments and  <code>false</code> otherwise.</p><p>Note that <code>both</code> implements the same idea for  functions as the <code>&amp;&amp;</code>(and) operator does for values, and <code>either</code> implements that same idea for functions as the <code>||</code>(or) operator does for values.</p><p>Ramda also provides  <code>allPass</code> and <code>anyPass</code> that take an array of any number of functions. As their names suggest, <code>allPass</code> works like <code>both</code>, and  <code>anyPass</code> works like <code>either</code>.</p><h2 id="Pipelines"><a href="#Pipelines" class="headerlink" title="Pipelines"></a>Pipelines</h2><p>Sometimes we want to apply several functions to some data in a pipeline fashion.For example, we might want to take tow numbers,multiply them together,and one, and square the result.We could write it like this.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> multiply = <span class="function">(<span class="params">a,b</span>) =&gt;</span> a*b   </span><br><span class="line"><span class="keyword">const</span> addOne = <span class="function"><span class="params">x</span> =&gt;</span> x + <span class="number">1</span></span><br><span class="line"><span class="keyword">const</span> square = <span class="function"><span class="params">x</span> =&gt;</span> x * x</span><br><span class="line"><span class="keyword">const</span> operate = <span class="function">(<span class="params">x, y</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> product = multiply(x,y)</span><br><span class="line">  <span class="keyword">const</span> incremented = addOne(product)</span><br><span class="line">  <span class="keyword">const</span> square = square(incremented)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> squared</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">operate(<span class="number">3</span>, <span class="number">4</span>) <span class="comment">// =&gt; ((3*4)+1)^2 ==&gt; (12 +1)^2 ==&gt; 169</span></span><br></pre></td></tr></table></figure><h3 id="Pipe"><a href="#Pipe" class="headerlink" title="Pipe"></a>Pipe</h3><p>Ramda provides the <code>pipe</code> functions,which takes a list of one or more functions and returns a new function.</p><p>The new function takes the same number of arguments as the first function it is given.It then ‘pipes’ those arguments through each function in the list.It applies<br>the first function to the arguments, passes its result to the second function and so on. The result of the last function is the result of the <code>pipe</code> call.</p><p>Note that all of the functions after the first must only take a single argument.</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">const</span> operate = pipe(</span><br><span class="line">  <span class="keyword">multiply,</span></span><br><span class="line"><span class="keyword"> </span> <span class="keyword">addOne,</span></span><br><span class="line"><span class="keyword"> </span> square</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h2 id="Compose"><a href="#Compose" class="headerlink" title="Compose"></a>Compose</h2><p><code>compose</code> works exactly the same way as <code>pipe</code>, except that it applies the functions in right-to-left order instead of left-to-right.</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">const</span> operate = compose(</span><br><span class="line">    square,</span><br><span class="line">    <span class="keyword">addOne,</span></span><br><span class="line"><span class="keyword"> </span>   <span class="keyword">multiply</span></span><br><span class="line"><span class="keyword">)</span></span><br></pre></td></tr></table></figure><p>I always think of <code>compose</code> this way: <code>compose(f,g)(value)</code> is equivalent to <code>f(g(value))</code>.</p><p>As with <code>pipe</code>, note that all of the functions except the last must only take a single argument.</p><hr><p><em>Cited From <a href="http://randycoulman.com/blog/2016/05/31/thinking-in-ramda-combining-functions/" target="_blank" rel="noopener">« Thinking in Ramda: Combining Functions »</a></em></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;Thinking-in-Ramda-Combining-funtions&quot;&gt;&lt;a href=&quot;#Thinking-in-Ramda-Combining-funtions&quot; class=&quot;headerlink&quot; title=&quot;Thinking in Ramda: Combining funtions&quot;&gt;&lt;/a&gt;Thinking in Ramda: Combining funtions&lt;/h1&gt;&lt;h2 id=&quot;Simple-Combinations&quot;&gt;&lt;a href=&quot;#Simple-Combinations&quot; class=&quot;headerlink&quot; title=&quot;Simple Combinations&quot;&gt;&lt;/a&gt;Simple Combinations&lt;/h2&gt;&lt;p&gt;Once you’ve gotten used to the idea of passing functions to other functions, you might start to find situations where you want to combine sereral functions together.&lt;/p&gt;
&lt;p&gt;Ramda provides several functions for doing simple combinations.&lt;/p&gt;
&lt;h2 id=&quot;Complement&quot;&gt;&lt;a href=&quot;#Complement&quot; class=&quot;headerlink&quot; title=&quot;Complement&quot;&gt;&lt;/a&gt;Complement&lt;/h2&gt;&lt;p&gt;Ramda provides a higher-order-function,&lt;code&gt;complement&lt;/code&gt;, that takes another function and return a new function that returns &lt;code&gt;true&lt;/code&gt; when the original function returns a falsy value, and &lt;code&gt;false&lt;/code&gt; when the original function returns a truthy value.&lt;br&gt;
    
    </summary>
    
      <category term="技术" scheme="http://jiaxf.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="functional" scheme="http://jiaxf.github.io/tags/functional/"/>
    
      <category term="javascript" scheme="http://jiaxf.github.io/tags/javascript/"/>
    
      <category term="ramda" scheme="http://jiaxf.github.io/tags/ramda/"/>
    
  </entry>
  
</feed>
